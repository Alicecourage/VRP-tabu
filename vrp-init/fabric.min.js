var fabric=fabric||{version:"1.6.0-rc.1"};"undefined"!==typeof exports&&(exports.fabric=fabric);"undefined"!==typeof document&&"undefined"!==typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow?fabric.document.createWindow():fabric.document.parentWindow);fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;
fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;
(function(){function h(a,e){this.__eventListeners[a]&&(e?fabric.util.removeFromArray(this.__eventListeners[a],e):this.__eventListeners[a].length=0)}function f(a,e){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var b in a)this.on(b,a[b]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(e);return this}function d(a,e){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===
typeof arguments[0])for(var b in a)h.call(this,b,a[b]);else h.call(this,a,e);return this}}function c(a,e){if(this.__eventListeners){var b=this.__eventListeners[a];if(b){for(var g=0,c=b.length;g<c;g++)b[g].call(this,e||{});return this}}}fabric.Observable={observe:f,stopObserving:d,fire:c,on:f,off:d,trigger:c}})();
fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var h=0,f=arguments.length;h<f;h++)this._onObjectAdded(arguments[h]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(h,f,d){var c=this.getObjects();d?c[f]=h:c.splice(f,0,h);this._onObjectAdded(h);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var h=this.getObjects(),f,d=0,c=arguments.length;d<c;d++)f=h.indexOf(arguments[d]),-1!==f&&(h.splice(f,1),this._onObjectRemoved(arguments[d]));
this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(h,f){for(var d=this.getObjects(),c=d.length;c--;)h.call(f,d[c],c,d);return this},getObjects:function(h){return"undefined"===typeof h?this._objects:this._objects.filter(function(f){return f.type===h})},item:function(h){return this.getObjects()[h]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(h){return-1<this.getObjects().indexOf(h)},complexity:function(){return this.getObjects().reduce(function(h,
f){return h+=f.complexity?f.complexity():0},0)}};
(function(h){var f=Math.sqrt,d=Math.atan2,c=Math.pow,a=Math.abs,e=Math.PI/180;fabric.util={removeFromArray:function(b,g){var e=b.indexOf(g);-1!==e&&b.splice(e,1);return b},getRandomInt:function(b,g){return Math.floor(Math.random()*(g-b+1))+b},degreesToRadians:function(b){return b*e},radiansToDegrees:function(b){return b/e},rotatePoint:function(b,g,e){b.subtractEquals(g);b=fabric.util.rotateVector(b,e);return(new fabric.Point(b.x,b.y)).addEquals(g)},rotateVector:function(b,g){var e=Math.sin(g),a=Math.cos(g);
return{x:b.x*a-b.y*e,y:b.x*e+b.y*a}},transformPoint:function(b,g,e){return e?new fabric.Point(g[0]*b.x+g[2]*b.y,g[1]*b.x+g[3]*b.y):new fabric.Point(g[0]*b.x+g[2]*b.y+g[4],g[1]*b.x+g[3]*b.y+g[5])},makeBoundingBoxFromPoints:function(b){var g=[b[0].x,b[1].x,b[2].x,b[3].x],e=fabric.util.array.min(g),g=fabric.util.array.max(g),g=Math.abs(e-g),a=[b[0].y,b[1].y,b[2].y,b[3].y];b=fabric.util.array.min(a);a=fabric.util.array.max(a);a=Math.abs(b-a);return{left:e,top:b,width:g,height:a}},invertTransform:function(b){var g=
1/(b[0]*b[3]-b[1]*b[2]),g=[g*b[3],-g*b[1],-g*b[2],g*b[0]];b=fabric.util.transformPoint({x:b[4],y:b[5]},g,!0);g[4]=-b.x;g[5]=-b.y;return g},toFixed:function(b,g){return parseFloat(Number(b).toFixed(g))},parseUnit:function(b,g){var e=/\D{0,2}$/.exec(b),a=parseFloat(b);g||(g=fabric.Text.DEFAULT_SVG_FONT_SIZE);switch(e[0]){case "mm":return a*fabric.DPI/25.4;case "cm":return a*fabric.DPI/2.54;case "in":return a*fabric.DPI;case "pt":return a*fabric.DPI/72;case "pc":return 12*(a*fabric.DPI/72);case "em":return a*
g;default:return a}},falseFunction:function(){return!1},getKlass:function(b,g){b=fabric.util.string.camelize(b.charAt(0).toUpperCase()+b.slice(1));return fabric.util.resolveNamespace(g)[b]},resolveNamespace:function(b){if(!b)return fabric;b=b.split(".");for(var g=b.length,e=h||fabric.window,a=0;a<g;++a)e=e[b[a]];return e},loadImage:function(b,g,e,a){if(b){var c=fabric.util.createImage();c.onload=function(){g&&g.call(e,c);c=c.onload=c.onerror=null};c.onerror=function(){fabric.log("Error loading "+
c.src);g&&g.call(e,null,!0);c=c.onload=c.onerror=null};0!==b.indexOf("data")&&a&&(c.crossOrigin=a);c.src=b}else g&&g.call(e,b)},enlivenObjects:function(b,g,e,a){function c(){++f===h&&g&&g(d)}b=b||[];var d=[],f=0,h=b.length;h?b.forEach(function(b,g){if(b&&b.type){var f=fabric.util.getKlass(b.type,e);f.async?f.fromObject(b,function(e,q){q||(d[g]=e,a&&a(b,d[g]));c()}):(d[g]=f.fromObject(b),a&&a(b,d[g]),c())}else c()}):g&&g(d)},groupSVGElements:function(b,g,e){b=new fabric.PathGroup(b,g);"undefined"!==
typeof e&&b.setSourcePath(e);return b},populateWithProperties:function(b,g,e){if(e&&"[object Array]"===Object.prototype.toString.call(e))for(var a=0,c=e.length;a<c;a++)e[a]in b&&(g[e[a]]=b[e[a]])},drawDashedLine:function(b,g,e,a,c,u){a-=g;var h=c-e;c=f(a*a+h*h);a=d(h,a);var h=u.length,y=0,t=!0;b.save();b.translate(g,e);b.moveTo(0,0);b.rotate(a);for(g=0;c>g;)g+=u[y++%h],g>c&&(g=c),b[t?"lineTo":"moveTo"](g,0),t=!t;b.restore()},createCanvasElement:function(b){b||(b=fabric.document.createElement("canvas"));
b.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(b);return b},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(b){b=b.prototype;for(var g=b.stateProperties.length;g--;){var e=b.stateProperties[g],a=e.charAt(0).toUpperCase()+e.slice(1),c="set"+a,a="get"+a;b[a]||(b[a]=new Function('return this.get("'+e+'")'));b[c]||(b[c]=new Function("value",'return this.set("'+e+'", value)'))}},
clipContext:function(b,g){g.save();g.beginPath();b.clipTo(g);g.clip()},multiplyTransformMatrices:function(b,g,e){return[b[0]*g[0]+b[2]*g[1],b[1]*g[0]+b[3]*g[1],b[0]*g[2]+b[2]*g[3],b[1]*g[2]+b[3]*g[3],e?0:b[0]*g[4]+b[2]*g[5]+b[4],e?0:b[1]*g[4]+b[3]*g[5]+b[5]]},qrDecompose:function(b){var g=d(b[1],b[0]),a=c(b[0],2)+c(b[1],2),z=f(a),v=(b[0]*b[3]-b[2]*b[1])/z,a=d(b[0]*b[2]+b[1]*b[3],a);return{angle:g/e,scaleX:z,scaleY:v,skewX:a/e,skewY:0,translateX:b[4],translateY:b[5]}},customTransformMatrix:function(b,
g,c){c=[1,0,a(Math.tan(c*e)),1];b=[a(b),0,0,a(g)];return fabric.util.multiplyTransformMatrices(b,c,!0)},resetObjectTransform:function(b){b.scaleX=1;b.scaleY=1;b.skewX=0;b.skewY=0;b.flipX=!1;b.flipY=!1;b.setAngle(0)},getFunctionBody:function(b){return(String(b).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(b,g,e,a){0<a&&(g=g>a?g-a:0,e=e>a?e-a:0);var c=!0;b=b.getImageData(g,e,2*a||1,2*a||1);g=3;for(e=b.data.length;g<e&&(c=0>=b.data[g],!1!==c);g+=4);return c},parsePreserveAspectRatioAttribute:function(b){var g=
"meet",a="Mid",e="Mid";b=b.split(" ");var c;b&&b.length&&(g=b.pop(),"meet"!==g&&"slice"!==g?(c=g,g="meet"):b.length&&(c=b.pop()));a="none"!==c?c.slice(1,4):"none";e="none"!==c?c.slice(5,8):"none";return{meetOrSlice:g,alignX:a,alignY:e}}}})("undefined"!==typeof exports?exports:this);
(function(){function h(b,e,c,u,h,y,t){var k=g.call(arguments);if(a[k])return a[k];var l=Math.PI,m=t*l/180,n=Math.sin(m),m=Math.cos(m),s=0,r=0;c=Math.abs(c);u=Math.abs(u);var p=0.5*-m*b-0.5*n*e,w=0.5*-m*e+0.5*n*b,B=c*c,A=u*u,D=w*w,x=p*p,E=B*A-B*D-A*x,F=0;0>E?(B=Math.sqrt(1-E/(B*A)),c*=B,u*=B):F=(h===y?-1:1)*Math.sqrt(E/(B*D+A*x));D=F*c*w/u;x=-F*u*p/c;F=m*D-n*x+0.5*b;B=n*D+m*x+0.5*e;A=d(1,0,(p-D)/c,(w-x)/u);w=d((p-D)/c,(w-x)/u,(-p-D)/c,(-w-x)/u);0===y&&0<w?w-=2*l:1===y&&0>w&&(w+=2*l);l=Math.ceil(Math.abs(2*
(w/l)));p=[];w/=l;D=8/3*Math.sin(w/4)*Math.sin(w/4)/Math.sin(w/2);x=A+w;for(E=0;E<l;E++)p[E]=f(A,x,m,n,c,u,F,B,D,s,r),s=p[E][4],r=p[E][5],A=x,x+=w;return a[k]=p}function f(b,a,c,d,f,h,t,k,l,m,n){var s=g.call(arguments);if(e[s])return e[s];var r=Math.cos(b),p=Math.sin(b),w=Math.cos(a),B=Math.sin(a),A=c*f*w-d*h*B+t,D=d*f*w+c*h*B+k;e[s]=[m+l*(-c*f*p-d*h*r),n+l*(-d*f*p+c*h*r),A+l*(c*f*B+d*h*w),D+l*(d*f*B-c*h*w),A,D];return e[s]}function d(b,g,e,a){b=Math.atan2(g,b);e=Math.atan2(a,e);return e>=b?e-b:2*
Math.PI-(b-e)}function c(e,a,c,d,f,h,t,k){var l=g.call(arguments);if(b[l])return b[l];var m=Math.sqrt,n=Math.min,s=Math.max,r=Math.abs,p=[],w=[[],[]],B,A,D,x,E;A=6*e-12*c+6*f;B=-3*e+9*c-9*f+3*t;D=3*c-3*e;for(var F=0;2>F;++F)0<F&&(A=6*a-12*d+6*h,B=-3*a+9*d-9*h+3*k,D=3*d-3*a),1E-12>r(B)?1E-12>r(A)||(x=-D/A,0<x&&1>x&&p.push(x)):(x=A*A-4*D*B,0>x||(E=m(x),x=(-A+E)/(2*B),0<x&&1>x&&p.push(x),x=(-A-E)/(2*B),0<x&&1>x&&p.push(x)));for(r=m=p.length;m--;)x=p[m],A=1-x,B=A*A*A*e+3*A*A*x*c+3*A*x*x*f+x*x*x*t,w[0][m]=
B,B=A*A*A*a+3*A*A*x*d+3*A*x*x*h+x*x*x*k,w[1][m]=B;w[0][r]=e;w[1][r]=a;w[0][r+1]=t;w[1][r+1]=k;n=[{x:n.apply(null,w[0]),y:n.apply(null,w[1])},{x:s.apply(null,w[0]),y:s.apply(null,w[1])}];return b[l]=n}var a={},e={},b={},g=Array.prototype.join;fabric.util.drawArc=function(b,g,e,a){var c=[[],[],[],[]];a=h(a[5]-g,a[6]-e,a[0],a[1],a[3],a[4],a[2]);for(var d=0,f=a.length;d<f;d++)c[d][0]=a[d][0]+g,c[d][1]=a[d][1]+e,c[d][2]=a[d][2]+g,c[d][3]=a[d][3]+e,c[d][4]=a[d][4]+g,c[d][5]=a[d][5]+e,b.bezierCurveTo.apply(b,
c[d])};fabric.util.getBoundsOfArc=function(b,g,a,e,d,f,t,k,l){var m=0,n=0,s=[],r=[];a=h(k-b,l-g,a,e,f,t,d);e=[[],[]];d=0;for(f=a.length;d<f;d++)s=c(m,n,a[d][0],a[d][1],a[d][2],a[d][3],a[d][4],a[d][5]),e[0].x=s[0].x+b,e[0].y=s[0].y+g,e[1].x=s[1].x+b,e[1].y=s[1].y+g,r.push(e[0]),r.push(e[1]),m=a[d][4],n=a[d][5];return r};fabric.util.getBoundsOfCurve=c})();
(function(){function h(d,c,a){if(d&&0!==d.length){var e=d.length-1,b=c?d[e][c]:d[e];if(c)for(;e--;)a(d[e][c],b)&&(b=d[e][c]);else for(;e--;)a(d[e],b)&&(b=d[e]);return b}}var f=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(d){if(void 0===this||null===this)throw new TypeError;var c=Object(this),a=c.length>>>0;if(0===a)return-1;var e=0;0<arguments.length&&(e=Number(arguments[1]),e!==e?e=0:0!==e&&e!==Number.POSITIVE_INFINITY&&e!==Number.NEGATIVE_INFINITY&&(e=(0<e||-1)*
Math.floor(Math.abs(e))));if(e>=a)return-1;for(e=0<=e?e:Math.max(a-Math.abs(e),0);e<a;e++)if(e in c&&c[e]===d)return e;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(d,c){for(var a=0,e=this.length>>>0;a<e;a++)a in this&&d.call(c,this[a],a,this)});Array.prototype.map||(Array.prototype.map=function(d,c){for(var a=[],e=0,b=this.length>>>0;e<b;e++)e in this&&(a[e]=d.call(c,this[e],e,this));return a});Array.prototype.every||(Array.prototype.every=function(d,c){for(var a=0,e=this.length>>>
0;a<e;a++)if(a in this&&!d.call(c,this[a],a,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(d,c){for(var a=0,e=this.length>>>0;a<e;a++)if(a in this&&d.call(c,this[a],a,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(d,c){for(var a=[],e,b=0,g=this.length>>>0;b<g;b++)b in this&&(e=this[b],d.call(c,e,b,this)&&a.push(e));return a});Array.prototype.reduce||(Array.prototype.reduce=function(d){var c=this.length>>>0,a=0,e;if(1<arguments.length)e=
arguments[1];else{do{if(a in this){e=this[a++];break}if(++a>=c)throw new TypeError;}while(1)}for(;a<c;a++)a in this&&(e=d.call(null,e,this[a],a,this));return e});fabric.util.array={invoke:function(d,c){for(var a=f.call(arguments,2),e=[],b=0,g=d.length;b<g;b++)e[b]=a.length?d[b][c].apply(d[b],a):d[b][c].call(d[b]);return e},min:function(d,c){return h(d,c,function(a,e){return a<e})},max:function(d,c){return h(d,c,function(a,e){return a>=e})}}})();
(function(){function h(f,d){for(var c in d)f[c]=d[c];return f}fabric.util.object={extend:h,clone:function(f){return h({},f)}}})();
(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:function(h){return h.replace(/-+(.)?/g,function(f,d){return d?d.toUpperCase():""})},capitalize:function(h,f){return h.charAt(0).toUpperCase()+(f?h.slice(1):h.slice(1).toLowerCase())},escapeXml:function(h){return h.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var h=Array.prototype.slice,f=Function.prototype.apply,d=function(){};Function.prototype.bind||(Function.prototype.bind=function(c){var a=this,e=h.call(arguments,1),b;b=e.length?function(){return f.call(a,this instanceof d?this:c,e.concat(h.call(arguments)))}:function(){return f.call(a,this instanceof d?this:c,arguments)};d.prototype=this.prototype;b.prototype=new d;return b})})();
(function(){function h(){}function f(b){var g=this.constructor.superclass.prototype[b];return 1<arguments.length?g.apply(this,d.call(arguments,1)):g.call(this)}var d=Array.prototype.slice,c=function(){},a=function(){for(var b in{toString:1})if("toString"===b)return!1;return!0}(),e=function(b,g,e){for(var c in g)c in b.prototype&&"function"===typeof b.prototype[c]&&-1<(g[c]+"").indexOf("callSuper")?b.prototype[c]=function(b){return function(){var a=this.constructor.superclass;this.constructor.superclass=
e;var c=g[b].apply(this,arguments);this.constructor.superclass=a;if("initialize"!==b)return c}}(c):b.prototype[c]=g[c],a&&(g.toString!==Object.prototype.toString&&(b.prototype.toString=g.toString),g.valueOf!==Object.prototype.valueOf&&(b.prototype.valueOf=g.valueOf))};fabric.util.createClass=function(){function b(){this.initialize.apply(this,arguments)}var g=null,a=d.call(arguments,0);"function"===typeof a[0]&&(g=a.shift());b.superclass=g;b.subclasses=[];g&&(h.prototype=g.prototype,b.prototype=new h,
g.subclasses.push(b));for(var z=0,v=a.length;z<v;z++)e(b,a[z],g);b.prototype.initialize||(b.prototype.initialize=c);b.prototype.constructor=b;b.prototype.callSuper=f;return b}})();
(function(){function h(b){var g=Array.prototype.slice.call(arguments,1),a,e,c=g.length;for(e=0;e<c;e++)if(a=typeof b[g[e]],!/^(?:function|object|unknown)$/.test(a))return!1;return!0}function f(b,g){return function(e){g.call(a(b),e||fabric.window.event)}}function d(b,g){return function(a){if(v[b]&&v[b][g])for(var e=v[b][g],c=0,d=e.length;c<d;c++)e[c].call(this,a||fabric.window.event)}}function c(b,g,a){var e="touchend"===b.type?"changedTouches":"touches";return b[e]&&b[e][0]?b[e][0][g]-(b[e][0][g]-
b[e][0][a])||b[a]:b[a]}var a,e,b=function(){var b=0;return function(g){return g.__uniqueID||(g.__uniqueID="uniqueID__"+b++)}}();(function(){var b={};a=function(g){return b[g]};e=function(g,a){b[g]=a}})();var g=h(fabric.document.documentElement,"addEventListener","removeEventListener")&&h(fabric.window,"addEventListener","removeEventListener"),q=h(fabric.document.documentElement,"attachEvent","detachEvent")&&h(fabric.window,"attachEvent","detachEvent"),z={},v={};g?(g=function(b,g,a){b.addEventListener(g,
a,!1)},q=function(b,g,a){b.removeEventListener(g,a,!1)}):q?(g=function(g,a,c){var d=b(g);e(d,g);z[d]||(z[d]={});z[d][a]||(z[d][a]=[]);c={handler:c,wrappedHandler:f(d,c)};z[d][a].push(c);g.attachEvent("on"+a,c.wrappedHandler)},q=function(g,a,e){var c=b(g),d;if(z[c]&&z[c][a])for(var q=0,f=z[c][a].length;q<f;q++)(d=z[c][a][q])&&d.handler===e&&(g.detachEvent("on"+a,d.wrappedHandler),z[c][a][q]=null)}):(g=function(g,a,e){var c=b(g);v[c]||(v[c]={});if(!v[c][a]){v[c][a]=[];var q=g["on"+a];q&&v[c][a].push(q);
g["on"+a]=d(c,a)}v[c][a].push(e)},q=function(g,a,e){g=b(g);if(v[g]&&v[g][a]){a=v[g][a];g=0;for(var c=a.length;g<c;g++)a[g]===e&&a.splice(g,1)}});fabric.util.addListener=g;fabric.util.removeListener=q;var u=function(b){return"unknown"!==typeof b.clientX?b.clientX:0},C=function(b){return"unknown"!==typeof b.clientY?b.clientY:0};fabric.isTouchSupported&&(u=function(b){return c(b,"pageX","clientX")},C=function(b){return c(b,"pageY","clientY")});fabric.util.getPointer=function(b){b||(b=fabric.window.event);
var g=fabric.util.getScrollLeftTop(b.target||("unknown"!==typeof b.srcElement?b.srcElement:null));return{x:u(b)+g.left,y:C(b)+g.top}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var h=fabric.document.createElement("div"),f="string"===typeof h.style.filter,d=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=function(a){return a};"string"===typeof h.style.opacity?c=function(a,e){a.style.opacity=e;return a}:f&&(c=function(a,e){var b=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(b.zoom=1);d.test(b.filter)?b.filter=b.filter.replace(d,0.9999<=e?"":"alpha(opacity="+100*e+")"):b.filter+=" alpha(opacity="+100*e+")";return a});fabric.util.setStyle=function(a,e){var b=a.style;
if(!b)return a;if("string"===typeof e)return a.style.cssText+=";"+e,-1<e.indexOf("opacity")?c(a,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var g in e)"opacity"===g?c(a,e[g]):b["float"===g||"cssFloat"===g?"undefined"===typeof b.styleFloat?"cssFloat":"styleFloat":g]=e[g];return a}})();
(function(){function h(b,a){var e=fabric.document.createElement(b),c;for(c in a)"class"===c?e.className=a[c]:"for"===c?e.htmlFor=a[c]:e.setAttribute(c,a[c]);return e}function f(b){for(var a=0,e=0,c=fabric.document.documentElement,d=fabric.document.body||{scrollLeft:0,scrollTop:0};b&&(b.parentNode||b.host)&&(b=b.parentNode||b.host,b===fabric.document?(a=d.scrollLeft||c.scrollLeft||0,e=d.scrollTop||c.scrollTop||0):(a+=b.scrollLeft||0,e+=b.scrollTop||0),1!==b.nodeType||"fixed"!==fabric.util.getElementStyle(b,
"position")););return{left:a,top:e}}var d=Array.prototype.slice,c,a=function(b){return d.call(b,0)};try{c=a(fabric.document.childNodes)instanceof Array}catch(e){}c||(a=function(b){for(var a=Array(b.length),e=b.length;e--;)a[e]=b[e];return a});var b;b=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(b,a){var e=fabric.document.defaultView.getComputedStyle(b,null);return e?e[a]:void 0}:function(b,a){var e=b.style[a];!e&&b.currentStyle&&(e=b.currentStyle[a]);return e};
(function(){var b=fabric.document.documentElement.style,a="userSelect"in b?"userSelect":"MozUserSelect"in b?"MozUserSelect":"WebkitUserSelect"in b?"WebkitUserSelect":"KhtmlUserSelect"in b?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(b){"undefined"!==typeof b.onselectstart&&(b.onselectstart=fabric.util.falseFunction);a?b.style[a]="none":"string"===typeof b.unselectable&&(b.unselectable="on");return b};fabric.util.makeElementSelectable=function(b){"undefined"!==typeof b.onselectstart&&
(b.onselectstart=null);a?b.style[a]="":"string"===typeof b.unselectable&&(b.unselectable="");return b}})();(function(){fabric.util.getScript=function(b,a){var e=fabric.document.getElementsByTagName("head")[0],c=fabric.document.createElement("script"),d=!0;c.onload=c.onreadystatechange=function(b){!d||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d=!1,a(b||fabric.window.event),c=c.onload=c.onreadystatechange=null)};c.src=b;e.appendChild(c)}})();fabric.util.getById=
function(b){return"string"===typeof b?fabric.document.getElementById(b):b};fabric.util.toArray=a;fabric.util.makeElement=h;fabric.util.addClass=function(b,a){b&&-1===(" "+b.className+" ").indexOf(" "+a+" ")&&(b.className+=(b.className?" ":"")+a)};fabric.util.wrapElement=function(b,a,e){"string"===typeof a&&(a=h(a,e));b.parentNode&&b.parentNode.replaceChild(a,b);a.appendChild(b);return a};fabric.util.getScrollLeftTop=f;fabric.util.getElementOffset=function(g){var a;a=g&&g.ownerDocument;var e={left:0,
top:0},c={left:0,top:0},d={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!a)return c;for(var h in d)c[d[h]]+=parseInt(b(g,h),10)||0;a=a.documentElement;"undefined"!==typeof g.getBoundingClientRect&&(e=g.getBoundingClientRect());g=f(g);return{left:e.left+g.left-(a.clientLeft||0)+c.left,top:e.top+g.top-(a.clientTop||0)+c.top}};fabric.util.getElementStyle=b})();
(function(){function h(){}var f=function(){for(var d=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],c=d.length;c--;)try{if(d[c]())return d[c]}catch(a){}}();fabric.util.request=function(d,c){c||(c={});var a=c.method?c.method.toUpperCase():"GET",e=c.onComplete||function(){},b=f(),g;b.onreadystatechange=function(){4===b.readyState&&(e(b),
b.onreadystatechange=h)};"GET"===a&&(g=null,"string"===typeof c.parameters&&(d=d+(/\?/.test(d)?"&":"?")+c.parameters));b.open(a,d,!0);"POST"!==a&&"PUT"!==a||b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.send(g);return b}})();fabric.log=function(){};fabric.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(h){"undefined"!==typeof console[h]&&"function"===typeof console[h].apply&&(fabric[h]=function(){return console[h].apply(console,arguments)})});
(function(h){function f(d,c){this.x=d;this.y=c}h=h.fabric||(h.fabric={});h.Point?h.warn("fabric.Point is already defined"):(h.Point=f,f.prototype={constructor:f,add:function(d){return new f(this.x+d.x,this.y+d.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(d){return new f(this.x+d,this.y+d)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(d){return new f(this.x-d.x,this.y-d.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},
scalarSubtract:function(d){return new f(this.x-d,this.y-d)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(d){return new f(this.x*d,this.y*d)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(d){return new f(this.x/d,this.y/d)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return this.x===d.x&&this.y===d.y},lt:function(d){return this.x<d.x&&this.y<d.y},lte:function(d){return this.x<=d.x&&this.y<=d.y},gt:function(d){return this.x>
d.x&&this.y>d.y},gte:function(d){return this.x>=d.x&&this.y>=d.y},lerp:function(d,c){return new f(this.x+(d.x-this.x)*c,this.y+(d.y-this.y)*c)},distanceFrom:function(d){var c=this.x-d.x;d=this.y-d.y;return Math.sqrt(c*c+d*d)},midPointFrom:function(d){return new f(this.x+(d.x-this.x)/2,this.y+(d.y-this.y)/2)},min:function(d){return new f(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new f(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},
setXY:function(d,c){this.x=d;this.y=c},setFromPoint:function(d){this.x=d.x;this.y=d.y},swap:function(d){var c=this.x,a=this.y;this.x=d.x;this.y=d.y;d.x=c;d.y=a}})})("undefined"!==typeof exports?exports:this);
(function(h){function f(c){this.status=c;this.points=[]}var d=h.fabric||(h.fabric={});d.Intersection?d.warn("fabric.Intersection is already defined"):(d.Intersection=f,d.Intersection.prototype={appendPoint:function(c){this.points.push(c)},appendPoints:function(c){this.points=this.points.concat(c)}},d.Intersection.intersectLineLine=function(c,a,e,b){var g,q=(b.x-e.x)*(c.y-e.y)-(b.y-e.y)*(c.x-e.x);g=(a.x-c.x)*(c.y-e.y)-(a.y-c.y)*(c.x-e.x);e=(b.y-e.y)*(a.x-c.x)-(b.x-e.x)*(a.y-c.y);0!==e?(q/=e,g/=e,0<=
q&&1>=q&&0<=g&&1>=g?(g=new f("Intersection"),g.points.push(new d.Point(c.x+q*(a.x-c.x),c.y+q*(a.y-c.y)))):g=new f):g=0===q||0===g?new f("Coincident"):new f("Parallel");return g},d.Intersection.intersectLinePolygon=function(c,a,e){for(var b=new f,g=e.length,d=0;d<g;d++){var z=f.intersectLineLine(c,a,e[d],e[(d+1)%g]);b.appendPoints(z.points)}0<b.points.length&&(b.status="Intersection");return b},d.Intersection.intersectPolygonPolygon=function(c,a){for(var e=new f,b=c.length,g=0;g<b;g++){var d=f.intersectLinePolygon(c[g],
c[(g+1)%b],a);e.appendPoints(d.points)}0<e.points.length&&(e.status="Intersection");return e},d.Intersection.intersectPolygonRectangle=function(c,a,e){var b=a.min(e),g=a.max(e);e=new d.Point(g.x,b.y);var q=new d.Point(b.x,g.y);a=f.intersectLinePolygon(b,e,c);e=f.intersectLinePolygon(e,g,c);g=f.intersectLinePolygon(g,q,c);c=f.intersectLinePolygon(q,b,c);b=new f;b.appendPoints(a.points);b.appendPoints(e.points);b.appendPoints(g.points);b.appendPoints(c.points);0<b.points.length&&(b.status="Intersection");
return b})})("undefined"!==typeof exports?exports:this);
(function(h){function f(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function d(a,e,b){0>b&&(b+=1);1<b&&(b-=1);return b<1/6?a+6*(e-a)*b:0.5>b?e:b<2/3?a+6*(e-a)*(2/3-b):a}var c=h.fabric||(h.fabric={});c.Color?c.warn("fabric.Color is already defined."):(c.Color=f,c.Color.prototype={_tryParsingColor:function(a){var e;a in f.colorNameMap&&(a=f.colorNameMap[a]);"transparent"===a?this.setSource([255,255,255,0]):((e=f.sourceFromHex(a))||(e=f.sourceFromRgb(a)),e||(e=f.sourceFromHsl(a)),e&&this.setSource(e))},
_rgbToHsl:function(a,e,b){a/=255;e/=255;b/=255;var g,d,f,v=c.util.array.max([a,e,b]);d=c.util.array.min([a,e,b]);f=(v+d)/2;if(v===d)g=d=0;else{var h=v-d;d=0.5<f?h/(2-v-d):h/(v+d);switch(v){case a:g=(e-b)/h+(e<b?6:0);break;case e:g=(b-a)/h+2;break;case b:g=(a-e)/h+4}g/=6}return[Math.round(360*g),Math.round(100*d),Math.round(100*f)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=
this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),e=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource(),e,b;e=a[0].toString(16);e=1===e.length?"0"+e:e;b=a[1].toString(16);b=1===b.length?"0"+b:b;a=a[2].toString(16);a=1===a.length?"0"+a:a;return e.toUpperCase()+
b.toUpperCase()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var e=this.getSource();e[3]=a;this.setSource(e);return this},toGrayscale:function(){var a=this.getSource(),e=parseInt((0.3*a[0]+0.59*a[1]+0.11*a[2]).toFixed(0),10);this.setSource([e,e,e,a[3]]);return this},toBlackWhite:function(a){var e=this.getSource(),b=(0.3*e[0]+0.59*e[1]+0.11*e[2]).toFixed(0),e=e[3],b=Number(b)<Number(a||127)?0:255;this.setSource([b,b,b,e]);return this},overlayWith:function(a){a instanceof
f||(a=new f(a));var e=[],b=this.getAlpha(),g=this.getSource();a=a.getSource();for(var c=0;3>c;c++)e.push(Math.round(0.5*g[c]+0.5*a[c]));e[3]=b;this.setSource(e);return this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aqua:"#00FFFF",
black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},c.Color.fromRgb=function(a){return f.fromSource(f.sourceFromRgb(a))},c.Color.sourceFromRgb=function(a){if(a=a.match(f.reRGBa)){var e=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),b=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?
255:1),g=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(e,10),parseInt(b,10),parseInt(g,10),a[4]?parseFloat(a[4]):1]}},c.Color.fromRgba=f.fromRgb,c.Color.fromHsl=function(a){return f.fromSource(f.sourceFromHsl(a))},c.Color.sourceFromHsl=function(a){if(a=a.match(f.reHSLa)){var e=(parseFloat(a[1])%360+360)%360/360,b=parseFloat(a[2])/(/%$/.test(a[2])?100:1),g=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===b)g=b=e=g;else var c=0.5>=g?g*(b+1):g+b-g*b,z=2*g-c,g=d(z,c,
e+1/3),b=d(z,c,e),e=d(z,c,e-1/3);return[Math.round(255*g),Math.round(255*b),Math.round(255*e),a[4]?parseFloat(a[4]):1]}},c.Color.fromHsla=f.fromHsl,c.Color.fromHex=function(a){return f.fromSource(f.sourceFromHex(a))},c.Color.sourceFromHex=function(a){if(a.match(f.reHex)){var e=a.slice(a.indexOf("#")+1),b=3===e.length;a=b?e.charAt(0)+e.charAt(0):e.substring(0,2);var g=b?e.charAt(1)+e.charAt(1):e.substring(2,4),e=b?e.charAt(2)+e.charAt(2):e.substring(4,6);return[parseInt(a,16),parseInt(g,16),parseInt(e,
16),1]}},c.Color.fromSource=function(a){var e=new f;e.setSource(a);return e})})("undefined"!==typeof exports?exports:this);
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var h=fabric.util.object.extend,f=fabric.util.getElementOffset,d=fabric.util.removeFromArray,c=fabric.util.toFixed,a=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,b){b||(b={});this._initStatic(a,b)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,
controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);this._initOptions(b);this._setImageSmoothing();this.interactive||this._initRetinaScaling();b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this));
b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this));b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this));this.calcOffset()},_initRetinaScaling:function(){1!==fabric.devicePixelRatio&&this.enableRetinaScaling&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},
calcOffset:function(){this._offset=f(this.lowerCanvasEl);return this},setOverlayImage:function(a,b,g){return this.__setBgOverlayImage("overlayImage",a,b,g)},setBackgroundImage:function(a,b,g){return this.__setBgOverlayImage("backgroundImage",a,b,g)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();"undefined"!==typeof a.imageSmoothingEnabled?
a.imageSmoothingEnabled=this.imageSmoothingEnabled:(a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,a.mozImageSmoothingEnabled=this.imageSmoothingEnabled,a.msImageSmoothingEnabled=this.imageSmoothingEnabled,a.oImageSmoothingEnabled=this.imageSmoothingEnabled)},__setBgOverlayImage:function(a,b,g,c){"string"===typeof b?fabric.util.loadImage(b,function(b){this[a]=new fabric.Image(b,c);g&&g(b)},this,c&&c.crossOrigin):(c&&b.setOptions(c),this[a]=b,g&&g(b));return this},__setBgOverlayColor:function(a,
b,g){if(b&&b.source){var c=this;fabric.util.loadImage(b.source,function(d){c[a]=new fabric.Pattern({source:d,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY});g&&g()})}else this[a]=b,g&&g();return this},_createCanvasElement:function(){var c=fabric.document.createElement("canvas");c.style||(c.style={});if(!c)throw a;this._initCanvasElement(c);return c},_initCanvasElement:function(c){fabric.util.createCanvasElement(c);if("undefined"===typeof c.getContext)throw a;},_initOptions:function(a){for(var b in a)this[b]=
a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);
fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var g;b=b||{};for(var c in a)g=a[c],b.cssOnly||(this._setBackstoreDimension(c,a[c]),g+="px"),
b.backstoreOnly||this._setCssDimension(c,g);this._initRetinaScaling();this._setImageSmoothing();this.calcOffset();b.cssOnly||this.renderAll();return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;this.upperCanvasEl&&(this.upperCanvasEl[a]=b);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b);this[a]=b;return this},_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=b;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b);this.wrapperEl&&(this.wrapperEl.style[a]=b);return this},
getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){var b=this.getActiveGroup();this.viewportTransform=a;this.renderAll();a=0;for(var g=this._objects.length;a<g;a++)this._objects[a].setCoords();b&&b.setCoords();return this},zoomToPoint:function(a,b){var g=a;a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=b;this.viewportTransform[3]=b;var c=fabric.util.transformPoint(a,
this.viewportTransform);this.viewportTransform[4]+=g.x-c.x;this.viewportTransform[5]+=g.y-c.y;this.renderAll();g=0;for(c=this._objects.length;g<c;g++)this._objects[g].setCoords();return this},setZoom:function(a){this.zoomToPoint(new fabric.Point(0,0),a);return this},absolutePan:function(a){this.viewportTransform[4]=-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var b=this._objects.length;a<b;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-
this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_onObjectAdded:function(a){this.stateful&&a.setupState();a._set("canvas",this);a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));
this.fire("object:removed",{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},_chooseObjectsToRender:function(){var a=
this.getActiveGroup(),b,g=[],c=[];if(a&&!this.preserveObjectStacking){for(var d=0,f=this._objects.length;d<f;d++)b=this._objects[d],a.contains(b)?c.push(b):g.push(b);a._set("_objects",c)}else g=this._objects;return g},renderAll:function(){var a=this.contextContainer,b;this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);this.clearContext(a);this.fire("before:render");this.clipTo&&fabric.util.clipContext(this,a);this._renderBackground(a);a.save();b=this._chooseObjectsToRender();
a.transform.apply(a,this.viewportTransform);this._renderObjects(a,b);this.preserveObjectStacking||this._renderObjects(a,[this.getActiveGroup()]);a.restore();!this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.clipTo&&a.restore();this._renderOverlay(a);this.controlsAboveOverlay&&this.interactive&&this.drawControls(a);this.fire("after:render");return this},_renderObjects:function(a,b){for(var g=0,c=b.length;g<c;++g)b[g]&&b[g].render(a)},_renderBackgroundOrOverlay:function(a,b){var g=
this[b+"Color"];g&&(a.fillStyle=g.toLive?g.toLive(a):g,a.fillRect(g.offsetX||0,g.offsetY||0,this.width,this.height));(g=this[b+"Image"])&&g.render(a)},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},renderTop:function(){this.clearContext(this.contextTop||this.contextContainer);this.selection&&this._groupSelector&&this._drawSelection();this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/
2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(a){var b=this.getCenter();this._centerObject(a,new fabric.Point(b.left,b.top));this.renderAll();return this},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");
return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,b){var g={objects:this._toObjects(a,b)};h(g,this.__serializeBgOverlay());fabric.util.populateWithProperties(this,g,b);return g},_toObjects:function(a,b){return this.getObjects().map(function(g){return this._toObject(g,a,b)},this)},_toObject:function(a,b,g){var c;
this.includeDefaultValues||(c=a.includeDefaultValues,a.includeDefaultValues=!1);var d=this._realizeGroupTransformOnObject(a);b=a[b](g);this.includeDefaultValues||(a.includeDefaultValues=c);this._unwindGroupTransformOnObject(a,d);return b},_realizeGroupTransformOnObject:function(a){var b="angle flipX flipY height left scaleX scaleY top width".split(" ");if(a.group&&a.group===this.getActiveGroup()){var g={};b.forEach(function(b){g[b]=a[b]});this.getActiveGroup().realizeTransform(a);return g}return null},
_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor);this.backgroundImage&&(a.backgroundImage=this.backgroundImage.toObject());this.overlayImage&&(a.overlayImage=this.overlayImage.toObject());return a},svgViewportTransformation:!0,toSVG:function(a,
b){a||(a={});var g=[];this._setSVGPreamble(g,a);this._setSVGHeader(g,a);this._setSVGBgOverlayColor(g,"backgroundColor");this._setSVGBgOverlayImage(g,"backgroundImage");this._setSVGObjects(g,b);this._setSVGBgOverlayColor(g,"overlayColor");this._setSVGBgOverlayImage(g,"overlayImage");g.push("</svg>");return g.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',
'"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var g=b.width||this.width,d=b.height||this.height,f;f='viewBox="0 0 '+this.width+" "+this.height+'" ';var v=fabric.Object.NUM_FRACTION_DIGITS;b.viewBox?f='viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':this.svgViewportTransformation&&(f=this.viewportTransform,f='viewBox="'+c(-f[4]/f[0],v)+" "+c(-f[5]/f[3],v)+" "+c(this.width/f[0],v)+" "+c(this.height/f[3],v)+'" ');a.push("<svg ",
'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',g,'" ','height="',d,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,f,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(a,b){for(var g=0,c=this.getObjects(),
d=c.length;g<d;g++){var f=c[g],h=this._realizeGroupTransformOnObject(f);a.push(f.toSVG(b));this._unwindGroupTransformOnObject(f,h)}},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?
this[b].source.height:this.height,'" fill="url(#'+b+'Pattern)"',"></rect>\n"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>\n")},sendToBack:function(a){d(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){d(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var g=this._objects.indexOf(a);0!==g&&(g=
this._findNewLowerIndex(a,g,b),d(this._objects,a),this._objects.splice(g,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,b,g){if(g)for(g=b,b-=1;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){g=b;break}}else g=b-1;return g},bringForward:function(a,b){var g=this._objects.indexOf(a);g!==this._objects.length-1&&(g=this._findNewUpperIndex(a,g,b),d(this._objects,a),this._objects.splice(g,
0,a),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(a,b,g){if(g)for(g=b,b+=1;b<this._objects.length;++b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){g=b;break}}else g=b+1;return g},moveTo:function(a,b){d(this._objects,a);this._objects.splice(b,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+
this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});h(fabric.StaticCanvas.prototype,fabric.Observable);h(fabric.StaticCanvas.prototype,fabric.Collection);h(fabric.StaticCanvas.prototype,fabric.DataURLExporter);h(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var g=b.getContext("2d");if(!g)return null;switch(a){case "getImageData":return"undefined"!==typeof g.getImageData;
case "setLineDash":return"undefined"!==typeof g.setLineDash;case "toDataURL":return"undefined"!==typeof b.toDataURL;case "toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(c){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}})();
(function(){var h=fabric.util.getPointer,f=fabric.util.degreesToRadians,d=fabric.util.radiansToDegrees,c=Math.atan2,a=Math.abs;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(b,g){g||(g={});this._initStatic(b,g);this._initInteractive();this._createCacheCanvas()},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,
hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},
_resetCurrentTransform:function(){var b=this._currentTransform;b.target.set({scaleX:b.original.scaleX,scaleY:b.original.scaleY,skewX:b.original.skewX,skewY:b.original.skewY,left:b.original.left,top:b.original.top});this._shouldCenterTransform(b.target)?"rotate"===b.action?this._setOriginToCenter(b.target):("center"!==b.originX&&(b.mouseXSign="right"===b.originX?-1:1),"center"!==b.originY&&(b.mouseYSign="bottom"===b.originY?-1:1),b.originX="center",b.originY="center"):(b.originX=b.original.originX,
b.originY=b.original.originY)},containsPoint:function(b,g){var a=this.getPointer(b,!0),c=this._normalizePointer(g,a);return g.containsPoint(c)||g._findTargetCorner(a)},_normalizePointer:function(b,a){var c=this.getActiveGroup(),e;c&&"group"!==b.type&&c.contains(b)&&(e=fabric.util.multiplyTransformMatrices(this.viewportTransform,c.calcTransformMatrix()),e=fabric.util.invertTransform(e),a=fabric.util.transformPoint(a,e,!1),c=fabric.util.transformPoint(c.getCenterPoint(),e,!1),a.x-=c.x,a.y-=c.y);return{x:a.x,
y:a.y}},isTargetTransparent:function(b,a,c){var e=b.hasBorders,d=b.transparentCorners;b.hasBorders=b.transparentCorners=!1;b.render(this.contextCache);b._renderControls(this.contextCache);b.hasBorders=e;b.transparentCorners=d;b=fabric.util.isTransparent(this.contextCache,a,c,this.targetFindTolerance);this.clearContext(this.contextCache);return b},_shouldClearSelection:function(b,a){var c=this.getActiveGroup(),e=this.getActiveObject();return!a||a&&c&&!c.contains(a)&&c!==a&&!b.shiftKey||a&&!a.evented||
a&&!a.selectable&&e&&e!==a},_shouldCenterTransform:function(b){if(b){var a=this._currentTransform,c;"scale"===a.action||"scaleX"===a.action||"scaleY"===a.action?c=this.centeredScaling||b.centeredScaling:"rotate"===a.action&&(c=this.centeredRotation||b.centeredRotation);return c?!a.altKey:a.altKey}},_getOriginFromCorner:function(b,a){var c={x:b.originX,y:b.originY};if("ml"===a||"tl"===a||"bl"===a)c.x="right";else if("mr"===a||"tr"===a||"br"===a)c.x="left";if("tl"===a||"mt"===a||"tr"===a)c.y="bottom";
else if("bl"===a||"mb"===a||"br"===a)c.y="top";return c},_getActionFromCorner:function(b,a,c){if(!a)return"drag";switch(a){case "mtr":return"rotate";case "ml":case "mr":return c.shiftKey?"skewY":"scaleX";case "mt":case "mb":return c.shiftKey?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(b,a){if(a){var c=this.getPointer(b),e=a._findTargetCorner(this.getPointer(b,!0)),d=this._getActionFromCorner(a,e,b),h=this._getOriginFromCorner(a,e);this._currentTransform={target:a,action:d,
corner:e,scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,offsetX:c.x-a.left,offsetY:c.y-a.top,originX:h.x,originY:h.y,ex:c.x,ey:c.y,lastX:c.x,lastY:c.y,left:a.left,top:a.top,theta:f(a.angle),width:a.width*a.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:b.shiftKey,altKey:b.altKey};this._currentTransform.original={left:a.left,top:a.top,scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,originX:h.x,originY:h.y};this._resetCurrentTransform()}},_translateObject:function(b,a){var c=this._currentTransform.target;
c.get("lockMovementX")||c.set("left",b-this._currentTransform.offsetX);c.get("lockMovementY")||c.set("top",a-this._currentTransform.offsetY)},_changeSkewTransformOrigin:function(b,a,c){var e="originX",d={0:"center"},f=a.target.skewX,h="left",y="right",t="mt"===a.corner||"ml"===a.corner?1:-1,k=1;b=0<b?1:-1;"y"===c&&(f=a.target.skewY,h="top",y="bottom",e="originY");d[-1]=h;d[1]=y;a.target.flipX&&(k*=-1);a.target.flipY&&(k*=-1);0===f?(a.skewSign=-t*b*k,a[e]=d[-b]):(f=0<f?1:-1,a.skewSign=f,a[e]=d[f*t*
k])},_skewObject:function(b,a,c){var e=this._currentTransform,d=e.target,f=d.get("lockSkewingX"),h=d.get("lockSkewingY");if(!(f&&"x"===c||h&&"y"===c)){var h=d.getCenterPoint(),y=d.toLocalPoint(new fabric.Point(b,a),"center","center")[c],t=d.toLocalPoint(new fabric.Point(e.lastX,e.lastY),"center","center")[c],f=d._getTransformedDimensions();this._changeSkewTransformOrigin(y-t,e,c);y=d.toLocalPoint(new fabric.Point(b,a),e.originX,e.originY)[c];h=d.translateToOriginPoint(h,e.originX,e.originY);this._setObjectSkew(y,
e,c,f);e.lastX=b;e.lastY=a;d.setPositionByOrigin(h,e.originX,e.originY)}},_setObjectSkew:function(b,a,c,e){var d=a.target,f=a.skewSign,h,y,t,k;"x"===c?(a="y",t="Y",h="X",y=0,k=d.skewY):(a="x",t="X",h="Y",y=d.skewX,k=0);y=d._getTransformedDimensions(y,k);b=2*Math.abs(b)-y[c];2>=b?b=0:(b=f*Math.atan(b/d["scale"+h]/(y[a]/d["scale"+t])),b=fabric.util.radiansToDegrees(b));d.set("skew"+h,b);0!==d["skew"+t]&&(h=d._getTransformedDimensions(),b=e[a]/h[a]*d["scale"+t],d.set("scale"+t,b))},_scaleObject:function(b,
a,c){var e=this._currentTransform,d=e.target,f=d.get("lockScalingX"),h=d.get("lockScalingY"),y=d.get("lockScalingFlip");if(!f||!h){var t=d.translateToOriginPoint(d.getCenterPoint(),e.originX,e.originY);b=d.toLocalPoint(new fabric.Point(b,a),e.originX,e.originY);a=d._getTransformedDimensions();this._setLocalMouse(b,e);this._setObjectScale(b,e,f,h,c,y,a);d.setPositionByOrigin(t,e.originX,e.originY)}},_setObjectScale:function(b,a,c,e,d,f,h){var y=a.target,t=!1,k=!1;a.newScaleX=b.x*y.scaleX/h.x;a.newScaleY=
b.y*y.scaleY/h.y;f&&0>=a.newScaleX&&a.newScaleX<y.scaleX&&(t=!0);f&&0>=a.newScaleY&&a.newScaleY<y.scaleY&&(k=!0);"equally"!==d||c||e?d?"x"!==d||y.get("lockUniScaling")?"y"!==d||y.get("lockUniScaling")||k||e||y.set("scaleY",a.newScaleY):t||c||y.set("scaleX",a.newScaleX):(t||c||y.set("scaleX",a.newScaleX),k||e||y.set("scaleY",a.newScaleY)):t||k||this._scaleObjectEqually(b,y,a,h);t||k||this._flipObject(a,d)},_scaleObjectEqually:function(b,a,c,e){b=b.y+b.x;e=e.y*c.original.scaleY/a.scaleY+e.x*c.original.scaleX/
a.scaleX;c.newScaleX=c.original.scaleX*b/e;c.newScaleY=c.original.scaleY*b/e;a.set("scaleX",c.newScaleX);a.set("scaleY",c.newScaleY)},_flipObject:function(b,a){0>b.newScaleX&&"y"!==a&&("left"===b.originX?b.originX="right":"right"===b.originX&&(b.originX="left"));0>b.newScaleY&&"x"!==a&&("top"===b.originY?b.originY="bottom":"bottom"===b.originY&&(b.originY="top"))},_setLocalMouse:function(b,g){var c=g.target;"right"===g.originX?b.x*=-1:"center"===g.originX&&(b.x=2*b.x*g.mouseXSign,0>b.x&&(g.mouseXSign=
-g.mouseXSign));"bottom"===g.originY?b.y*=-1:"center"===g.originY&&(b.y=2*b.y*g.mouseYSign,0>b.y&&(g.mouseYSign=-g.mouseYSign));a(b.x)>c.padding?b.x=0>b.x?b.x+c.padding:b.x-c.padding:b.x=0;a(b.y)>c.padding?b.y=0>b.y?b.y+c.padding:b.y-c.padding:b.y=0},_rotateObject:function(b,a){var e=this._currentTransform;if(!e.target.get("lockRotation")){var f=c(e.ey-e.top,e.ex-e.left),h=c(a-e.top,b-e.left),f=d(h-f+e.theta);0>f&&(f=360+f);e.target.angle=f%360}},setCursor:function(b){this.upperCanvasEl.style.cursor=
b},_resetObjectTransform:function(b){b.scaleX=1;b.scaleY=1;b.skewX=0;b.skewY=0;b.setAngle(0)},_drawSelection:function(){var b=this.contextTop,g=this._groupSelector,c=g.left,e=g.top,d=a(c),f=a(e);b.fillStyle=this.selectionColor;b.fillRect(g.ex-(0<c?0:-c),g.ey-(0<e?0:-e),d,f);b.lineWidth=this.selectionLineWidth;b.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(c=g.ex+0.5-(0<c?0:d),g=g.ey+0.5-(0<e?0:f),b.beginPath(),fabric.util.drawDashedLine(b,c,g,c+d,g,this.selectionDashArray),
fabric.util.drawDashedLine(b,c,g+f-1,c+d,g+f-1,this.selectionDashArray),fabric.util.drawDashedLine(b,c,g,c,g+f,this.selectionDashArray),fabric.util.drawDashedLine(b,c+d-1,g,c+d-1,g+f,this.selectionDashArray),b.closePath(),b.stroke()):b.strokeRect(g.ex+0.5-(0<c?0:d),g.ey+0.5-(0<e?0:f),d,f)},_isLastRenderedObject:function(b){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(b,this.lastRenderedObjectWithControlsAboveOverlay)&&
this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(b,!0))},findTarget:function(b,a){if(!this.skipTargetFind){if(this._isLastRenderedObject(b))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!a&&this.containsPoint(b,c))return c;c=this._searchPossibleTargets(b,a);this._fireOverOutEvents(c,b);return c}},_fireOverOutEvents:function(b,a){b?this._hoveredTarget!==b&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,
e:a}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:b,e:a}),b.fire("mouseover"),this._hoveredTarget=b):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:a}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(b,a,c){if(a&&a.visible&&a.evented&&this.containsPoint(b,a)&&(!this.perPixelTargetFind&&!a.perPixelTargetFind||a.isEditing||!this.isTargetTransparent(a,c.x,c.y)))return!0},_searchPossibleTargets:function(b,a){for(var c,
e=this.getPointer(b,!0),d=this._objects.length;d--;)if((!this._objects[d].group||a)&&this._checkTarget(b,this._objects[d],e)){this.relatedTarget=this._objects[d];c=this._objects[d];break}return c},getPointer:function(b,a,c){c||(c=this.upperCanvasEl);b=h(b);var e=c.getBoundingClientRect(),d=e.width||0,f=e.height||0;d&&f||("top"in e&&"bottom"in e&&(f=Math.abs(e.top-e.bottom)),"right"in e&&"left"in e&&(d=Math.abs(e.right-e.left)));this.calcOffset();b.x-=this._offset.left;b.y-=this._offset.top;a||(b=
fabric.util.transformPoint(b,fabric.util.invertTransform(this.viewportTransform)));0===d||0===f?c=a=1:(a=c.width/d,c=c.height/f);return{x:b.x*a,y:b.y*c}},_createUpperCanvas:function(){var b=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+b);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);
this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+
"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(b){var a=this.getWidth()||b.width,c=this.getHeight()||b.height;fabric.util.setStyle(b,{position:"absolute",width:a+"px",height:c+"px",left:0,top:0});b.width=a;b.height=c;fabric.util.makeElementUnselectable(b)},_copyCanvasStyle:function(b,a){a.style.cssText=b.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(b){this._activeObject&&
this._activeObject.set("active",!1);this._activeObject=b;b.set("active",!0)},setActiveObject:function(b,a){this._setActiveObject(b);this.renderAll();this.fire("object:selected",{target:b,e:a});b.fire("selected",{e:a});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(b){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",
{e:b});return this},_setActiveGroup:function(b){(this._activeGroup=b)&&b.set("active",!0)},setActiveGroup:function(b,a){this._setActiveGroup(b);b&&(this.fire("object:selected",{target:b,e:a}),b.fire("selected",{e:a}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var b=this.getActiveGroup();b&&b.destroy();this.setActiveGroup(null)},discardActiveGroup:function(b){this._discardActiveGroup();this.fire("selection:cleared",{e:b});return this},deactivateAll:function(){for(var b=
this.getObjects(),a=0,c=b.length;a<c;a++)b[a].set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(b){var a=this.getActiveGroup()||this.getActiveObject();a&&this.fire("before:selection:cleared",{target:a,e:b});this.deactivateAll();a&&this.fire("selection:cleared",{e:b});return this},drawControls:function(b){var a=this.getActiveGroup();a?a._renderControls(b):this._drawObjectsControls(b)},_drawObjectsControls:function(b){for(var a=0,
c=this._objects.length;a<c;++a)this._objects[a]&&this._objects[a].active&&(this._objects[a]._renderControls(b),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[a])}});for(var e in fabric.StaticCanvas)"prototype"!==e&&(fabric.Canvas[e]=fabric.StaticCanvas[e]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas})();
(function(){var h={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},f=fabric.util.addListener,d=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();f(fabric.window,"resize",this._onResize);f(this.upperCanvasEl,"mousedown",this._onMouseDown);f(this.upperCanvasEl,"mousemove",this._onMouseMove);f(this.upperCanvasEl,"mousewheel",this._onMouseWheel);
f(this.upperCanvasEl,"touchstart",this._onMouseDown);f(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);
this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){d(fabric.window,"resize",this._onResize);d(this.upperCanvasEl,"mousedown",
this._onMouseDown);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"mousewheel",this._onMouseWheel);d(this.upperCanvasEl,"touchstart",this._onMouseDown);d(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,
"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(c,a){this.__onTransformGesture&&this.__onTransformGesture(c,a)},_onDrag:function(c,a){this.__onDrag&&this.__onDrag(c,a)},_onMouseWheel:function(c,a){this.__onMouseWheel&&this.__onMouseWheel(c,a)},_onOrientationChange:function(c,a){this.__onOrientationChange&&this.__onOrientationChange(c,a)},_onShake:function(c,a){this.__onShake&&this.__onShake(c,a)},_onLongPress:function(c,a){this.__onLongPress&&
this.__onLongPress(c,a)},_onMouseDown:function(c){this.__onMouseDown(c);f(fabric.document,"touchend",this._onMouseUp);f(fabric.document,"touchmove",this._onMouseMove);d(this.upperCanvasEl,"mousemove",this._onMouseMove);d(this.upperCanvasEl,"touchmove",this._onMouseMove);"touchstart"===c.type?d(this.upperCanvasEl,"mousedown",this._onMouseDown):(f(fabric.document,"mouseup",this._onMouseUp),f(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(c){this.__onMouseUp(c);d(fabric.document,
"mouseup",this._onMouseUp);d(fabric.document,"touchend",this._onMouseUp);d(fabric.document,"mousemove",this._onMouseMove);d(fabric.document,"touchmove",this._onMouseMove);f(this.upperCanvasEl,"mousemove",this._onMouseMove);f(this.upperCanvasEl,"touchmove",this._onMouseMove);if("touchend"===c.type){var a=this;setTimeout(function(){f(a.upperCanvasEl,"mousedown",a._onMouseDown)},400)}},_onMouseMove:function(c){!this.allowTouchScrolling&&c.preventDefault&&c.preventDefault();this.__onMouseMove(c)},_onResize:function(){this.calcOffset()},
_shouldRender:function(c,a){var e=this.getActiveGroup()||this.getActiveObject();return!!(c&&(c.isMoving||c!==e)||!c&&e||!c&&!e&&!this._groupSelector||a&&this._previousPointer&&this.selection&&(a.x!==this._previousPointer.x||a.y!==this._previousPointer.y))},__onMouseUp:function(c){var a;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(c);else{this._currentTransform?(this._finalizeCurrentTransform(),a=this._currentTransform.target):a=this.findTarget(c,!0);var e=this._shouldRender(a,
this.getPointer(c));this._maybeGroupObjects(c);a&&(a.isMoving=!1);e&&this.renderAll();this._handleCursorAndEvent(c,a)}},_handleCursorAndEvent:function(c,a){this._setCursorFromEvent(c,a);var e=this;setTimeout(function(){e._setCursorFromEvent(c,a)},50);this.fire("mouse:up",{target:a,e:c});a&&a.fire("mouseup",{e:c})},_finalizeCurrentTransform:function(){var c=this._currentTransform.target;c._scaling&&(c._scaling=!1);c.setCoords();this.stateful&&c.hasStateChanged()&&(this.fire("object:modified",{target:c}),
c.fire("modified"));this._restoreOriginXY(c)},_restoreOriginXY:function(c){if(this._previousOriginX&&this._previousOriginY){var a=c.translateToOriginPoint(c.getCenterPoint(),this._previousOriginX,this._previousOriginY);c.originX=this._previousOriginX;c.originY=this._previousOriginY;c.left=a.x;c.top=a.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(c){this._isCurrentlyDrawing=!0;this.discardActiveObject(c).renderAll();this.clipTo&&fabric.util.clipContext(this,
this.contextTop);var a=fabric.util.invertTransform(this.viewportTransform),a=fabric.util.transformPoint(this.getPointer(c,!0),a);this.freeDrawingBrush.onMouseDown(a);this.fire("mouse:down",{e:c});a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mousedown",{e:c,target:a})},_onMouseMoveInDrawingMode:function(c){if(this._isCurrentlyDrawing){var a=fabric.util.invertTransform(this.viewportTransform),a=fabric.util.transformPoint(this.getPointer(c,!0),a);this.freeDrawingBrush.onMouseMove(a)}this.setCursor(this.freeDrawingCursor);
this.fire("mouse:move",{e:c});a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mousemove",{e:c,target:a})},_onMouseUpInDrawingMode:function(c){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:c});var a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mouseup",{e:c,target:a})},__onMouseDown:function(c){if(("which"in c?1===c.which:0===c.button)||fabric.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(c);
else if(!this._currentTransform){var a=this.findTarget(c),e=this.getPointer(c,!0);this._previousPointer=e;var b=this._shouldRender(a,e),g=this._shouldGroup(c,a);this._shouldClearSelection(c,a)?this._clearSelection(c,a,e):g&&(this._handleGrouping(c,a),a=this.getActiveGroup());a&&a.selectable&&(a.__corner||!g)&&(this._beforeTransform(c,a),this._setupCurrentTransform(c,a));b&&this.renderAll();this.fire("mouse:down",{target:a,e:c});a&&a.fire("mousedown",{e:c})}},_beforeTransform:function(c,a){this.stateful&&
a.saveState();if(a._findTargetCorner(this.getPointer(c)))this.onBeforeScaleRotate(a);a!==this.getActiveGroup()&&a!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(a,c))},_clearSelection:function(c,a,e){this.deactivateAllWithDispatch(c);a&&a.selectable?this.setActiveObject(a,c):this.selection&&(this._groupSelector={ex:e.x,ey:e.y,top:0,left:0})},_setOriginToCenter:function(c){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;
var a=c.getCenterPoint();c.originX="center";c.originY="center";c.left=a.x;c.top=a.y;this._currentTransform.left=c.left;this._currentTransform.top=c.top},_setCenterToOrigin:function(c){var a=c.translateToOriginPoint(c.getCenterPoint(),this._previousOriginX,this._previousOriginY);c.originX=this._previousOriginX;c.originY=this._previousOriginY;c.left=a.x;c.top=a.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(c){var a,e;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(c);
else if(!("undefined"!==typeof c.touches&&1<c.touches.length)){var b=this._groupSelector;b?(e=this.getPointer(c,!0),b.left=e.x-b.ex,b.top=e.y-b.ey,this.renderTop()):this._currentTransform?this._transformObject(c):(a=this.findTarget(c),!a||a&&!a.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(c,a));this.fire("mouse:move",{target:a,e:c});a&&a.fire("mousemove",{e:c})}},_transformObject:function(c){var a=this.getPointer(c),e=this._currentTransform;e.reset=!1;e.target.isMoving=!0;
this._beforeScaleTransform(c,e);this._performTransformAction(c,e,a);this.renderAll()},_performTransformAction:function(c,a,e){var b=e.x;e=e.y;var g=a.target,d=a.action;"rotate"===d?(this._rotateObject(b,e),this._fire("rotating",g,c)):"scale"===d?(this._onScale(c,a,b,e),this._fire("scaling",g,c)):"scaleX"===d?(this._scaleObject(b,e,"x"),this._fire("scaling",g,c)):"scaleY"===d?(this._scaleObject(b,e,"y"),this._fire("scaling",g,c)):"skewX"===d?(this._skewObject(b,e,"x"),this._fire("skewing",g,c)):"skewY"===
d?(this._skewObject(b,e,"y"),this._fire("skewing",g,c)):(this._translateObject(b,e),this._fire("moving",g,c),this.setCursor(this.moveCursor))},_fire:function(c,a,e){this.fire("object:"+c,{target:a,e:e});a.fire(c,{e:e})},_beforeScaleTransform:function(c,a){if("scale"===a.action||"scaleX"===a.action||"scaleY"===a.action){var e=this._shouldCenterTransform(a.target);if(e&&("center"!==a.originX||"center"!==a.originY)||!e&&"center"===a.originX&&"center"===a.originY)this._resetCurrentTransform(),a.reset=
!0}},_onScale:function(c,a,e,b){!c.shiftKey&&!this.uniScaleTransform||a.target.get("lockUniScaling")?(a.reset||"scale"!==a.currentAction||this._resetCurrentTransform(),a.currentAction="scaleEqually",this._scaleObject(e,b,"equally")):(a.currentAction="scale",this._scaleObject(e,b))},_setCursorFromEvent:function(c,a){if(a&&a.selectable){var e=this.getActiveGroup();(e=a._findTargetCorner&&(!e||!e.contains(a))&&a._findTargetCorner(this.getPointer(c,!0)))?this._setCornerCursor(e,a,c):this.setCursor(a.hoverCursor||
this.hoverCursor)}else return this.setCursor(this.defaultCursor),!1;return!0},_setCornerCursor:function(c,a,e){if(c in h)this.setCursor(this._getRotatedCornerCursor(c,a,e));else if("mtr"===c&&a.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(c,a,e){a=Math.round(a.getAngle()%360/45);0>a&&(a+=8);a+=h[c];e.shiftKey&&0===h[c]%2&&(a+=2);return this.cursorMap[a%8]}})})();
(function(){var h=Math.min,f=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(d,c){var a=this.getActiveObject();return d.shiftKey&&c&&c.selectable&&(this.getActiveGroup()||a&&a!==c)&&this.selection},_handleGrouping:function(d,c){if(c===this.getActiveGroup()&&(c=this.findTarget(d,!0),!c||c.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(c,d):this._createActiveGroup(c,d);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(d,
c){var a=this.getActiveGroup();if(a.contains(d)){if(a.removeWithUpdate(d),d.set("active",!1),1===a.size()){this.discardActiveGroup(c);this.setActiveObject(a.item(0));return}}else a.addWithUpdate(d);this.fire("selection:created",{target:a,e:c});a.set("active",!0)},_createActiveGroup:function(d,c){if(this._activeObject&&d!==this._activeObject){var a=this._createGroup(d);a.addWithUpdate();this.setActiveGroup(a);this._activeObject=null;this.fire("selection:created",{target:a,e:c})}d.set("active",!0)},
_createGroup:function(d){var c=this.getObjects();d=c.indexOf(this._activeObject)<c.indexOf(d)?[this._activeObject,d]:[d,this._activeObject];return new fabric.Group(d,{canvas:this})},_groupSelectedObjects:function(d){var c=this._collectObjects();1===c.length?this.setActiveObject(c[0],d):1<c.length&&(c=new fabric.Group(c.reverse(),{canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,d),c.saveCoords(),this.fire("selection:created",{target:c}),this.renderAll())},_collectObjects:function(){var d=[],
c;c=this._groupSelector.ex;for(var a=this._groupSelector.ey,e=c+this._groupSelector.left,b=a+this._groupSelector.top,g=new fabric.Point(h(c,e),h(a,b)),q=new fabric.Point(f(c,e),f(a,b)),a=c===e&&a===b,e=this._objects.length;e--&&!((c=this._objects[e])&&c.selectable&&c.visible&&(c.intersectsWithRect(g,q)||c.isContainedWithinRect(g,q)||c.containsPoint(g)||c.containsPoint(q))&&(c.set("active",!0),d.push(c),a)););return d},_maybeGroupObjects:function(d){this.selection&&this._groupSelector&&this._groupSelectedObjects(d);
if(d=this.getActiveGroup())d.setObjectsCoords().setCoords(),d.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(h){h||(h={});var f=h.format||"png",d=h.quality||1,c=h.multiplier||1;h={left:h.left,top:h.top,width:h.width,height:h.height};return 1!==c?this.__toDataURLWithMultiplier(f,d,h,c):this.__toDataURL(f,d,h)},__toDataURL:function(h,f,d){this.renderAll();var c=this.contextContainer.canvas;d=this.__getCroppedCanvas(c,d);"jpg"===h&&(h="jpeg");return fabric.StaticCanvas.supports("toDataURLWithQuality")?(d||c).toDataURL("image/"+h,f):
(d||c).toDataURL("image/"+h)},__getCroppedCanvas:function(h,f){var d,c;if("left"in f||"top"in f||"width"in f||"height"in f)d=fabric.util.createCanvasElement(),c=d.getContext("2d"),d.width=f.width||this.width,d.height=f.height||this.height,c.drawImage(h,-f.left||0,-f.top||0);return d},__toDataURLWithMultiplier:function(h,f,d,c){var a=this.getWidth(),e=this.getHeight(),b=a*c,g=e*c,q=this.getActiveObject(),z=this.getActiveGroup(),v=this.contextContainer;1<c&&this.setWidth(b).setHeight(g);v.scale(c,c);
d.left&&(d.left*=c);d.top&&(d.top*=c);d.width?d.width*=c:1>c&&(d.width=b);d.height?d.height*=c:1>c&&(d.height=g);z?this._tempRemoveBordersControlsFromGroup(z):q&&this.deactivateAll&&this.deactivateAll();h=this.__toDataURL(h,f,d);this.width=a;this.height=e;v.scale(1/c,1/c);this.setWidth(a).setHeight(e);z?this._restoreBordersControlsOnGroup(z):q&&this.setActiveObject&&this.setActiveObject(q);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return h},toDataURLWithMultiplier:function(h,
f,d){return this.toDataURL({format:h,multiplier:f,quality:d})},_tempRemoveBordersControlsFromGroup:function(h){h.origHasControls=h.hasControls;h.origBorderColor=h.borderColor;h.hasControls=!0;h.borderColor="rgba(0,0,0,0)";h.forEachObject(function(f){f.origBorderColor=f.borderColor;f.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(h){h.hideControls=h.origHideControls;h.borderColor=h.origBorderColor;h.forEachObject(function(f){f.borderColor=f.origBorderColor;delete f.origBorderColor})}});
(function(h){var f=h.fabric||(h.fabric={});h=f.util.object.extend;var d=f.util.toFixed,c=f.util.string.capitalize,a=f.util.degreesToRadians,e=f.StaticCanvas.supports("setLineDash");f.Object||(f.Object=f.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,
centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,
lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor alignX alignY meetOrSlice skewX skewY".split(" "),initialize:function(b){b&&this.setOptions(b)},_initGradient:function(b){!b.fill||
!b.fill.colorStops||b.fill instanceof f.Gradient||this.set("fill",new f.Gradient(b.fill));!b.stroke||!b.stroke.colorStops||b.stroke instanceof f.Gradient||this.set("stroke",new f.Gradient(b.stroke))},_initPattern:function(b){!b.fill||!b.fill.source||b.fill instanceof f.Pattern||this.set("fill",new f.Pattern(b.fill));!b.stroke||!b.stroke.source||b.stroke instanceof f.Pattern||this.set("stroke",new f.Pattern(b.stroke))},_initClipping:function(b){b.clipTo&&"string"===typeof b.clipTo&&(b=f.util.getFunctionBody(b.clipTo),
"undefined"!==typeof b&&(this.clipTo=new Function("ctx",b)))},setOptions:function(b){for(var a in b)this.set(a,b[a]);this._initGradient(b);this._initPattern(b);this._initClipping(b)},transform:function(b,c){this.group&&this.canvas.preserveObjectStacking&&this.group===this.canvas._activeGroup&&this.group.transform(b);var e=c?this._getLeftTopCoords():this.getCenterPoint();b.translate(e.x,e.y);b.rotate(a(this.angle));b.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1));b.transform(1,
0,Math.tan(a(this.skewX)),1,0,0);b.transform(1,Math.tan(a(this.skewY)),0,1,0,0)},toObject:function(b){var a=f.Object.NUM_FRACTION_DIGITS,a={type:this.type,originX:this.originX,originY:this.originY,left:d(this.left,a),top:d(this.top,a),width:d(this.width,a),height:d(this.height,a),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:d(this.strokeWidth,a),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():
this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:d(this.strokeMiterLimit,a),scaleX:d(this.scaleX,a),scaleY:d(this.scaleY,a),angle:d(this.getAngle(),a),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,a),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,
transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:d(this.skewX,a),skewY:d(this.skewY,a)};this.includeDefaultValues||(a=this._removeDefaultValues(a));f.util.populateWithProperties(this,a,b);return a},toDatalessObject:function(b){return this.toObject(b)},_removeDefaultValues:function(b){var a=f.util.getKlass(b.type).prototype;a.stateProperties.forEach(function(c){b[c]===a[c]&&delete b[c];"[object Array]"===Object.prototype.toString.call(b[c])&&"[object Array]"===
Object.prototype.toString.call(a[c])&&0===b[c].length&&0===a[c].length&&delete b[c]});return b},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(b){return this[b]},_setObject:function(b){for(var a in b)this._set(a,b[a])},set:function(b,a){"object"===typeof b?this._setObject(b):"function"===typeof a&&"clipTo"!==b?this._set(b,a(this.get(b))):this._set(b,a);return this},_set:function(b,a){if("scaleX"===b||"scaleY"===b)a=this._constrainScale(a);"scaleX"===b&&0>a?(this.flipX=!this.flipX,
a*=-1):"scaleY"===b&&0>a?(this.flipY=!this.flipY,a*=-1):"width"===b||"height"===b?this.minScaleLimit=d(Math.min(0.1,1/Math.max(this.width,this.height)),2):"shadow"!==b||!a||a instanceof f.Shadow||(a=new f.Shadow(a));this[b]=a;return this},setOnGroup:function(){},toggle:function(b){var a=this.get(b);"boolean"===typeof a&&this.set(b,!a);return this},setSourcePath:function(b){this.sourcePath=b;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:
[1,0,0,1,0,0]},render:function(b,a){0===this.width&&0===this.height||!this.visible||(b.save(),this._setupCompositeOperation(b),a||this.transform(b),this._setStrokeStyles(b),this._setFillStyles(b),this.transformMatrix&&b.transform.apply(b,this.transformMatrix),this._setOpacity(b),this._setShadow(b),this.clipTo&&f.util.clipContext(this,b),this._render(b,a),this.clipTo&&b.restore(),b.restore())},_setOpacity:function(b){this.group&&this.group._setOpacity(b);b.globalAlpha*=this.opacity},_setStrokeStyles:function(b){this.stroke&&
(b.lineWidth=this.strokeWidth,b.lineCap=this.strokeLineCap,b.lineJoin=this.strokeLineJoin,b.miterLimit=this.strokeMiterLimit,b.strokeStyle=this.stroke.toLive?this.stroke.toLive(b,this):this.stroke)},_setFillStyles:function(b){this.fill&&(b.fillStyle=this.fill.toLive?this.fill.toLive(b,this):this.fill)},_renderControls:function(b,c){if(this.active&&!c){var e=this.getViewportTransform(),d=this.calcTransformMatrix(),d=f.util.multiplyTransformMatrices(e,d),e=f.util.qrDecompose(d);b.save();b.translate(e.translateX,
e.translateY);this.group&&this.group===this.canvas.getActiveGroup()?(b.rotate(a(e.angle)),this.drawBordersInGroup(b,e)):(b.rotate(a(this.angle)),this.drawBorders(b));this.drawControls(b);b.restore()}},_setShadow:function(b){if(this.shadow){var a=this.canvas&&this.canvas.viewportTransform[0]||1,c=this.canvas&&this.canvas.viewportTransform[3]||1;b.shadowColor=this.shadow.color;b.shadowBlur=this.shadow.blur*(a+c)*(this.scaleX+this.scaleY)/4;b.shadowOffsetX=this.shadow.offsetX*a*this.scaleX;b.shadowOffsetY=
this.shadow.offsetY*c*this.scaleY}},_removeShadow:function(b){this.shadow&&(b.shadowColor="",b.shadowBlur=b.shadowOffsetX=b.shadowOffsetY=0)},_renderFill:function(b){this.fill&&(b.save(),this.fill.gradientTransform&&b.transform.apply(b,this.fill.gradientTransform),this.fill.toLive&&b.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?b.fill("evenodd"):b.fill(),b.restore())},_renderStroke:function(b){this.stroke&&0!==this.strokeWidth&&(this.shadow&&
!this.shadow.affectStroke&&this._removeShadow(b),b.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e?(b.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(b)):this._renderDashedStroke&&this._renderDashedStroke(b),b.stroke()):(this.stroke.gradientTransform&&b.transform.apply(b,this.stroke.gradientTransform),this._stroke?this._stroke(b):b.stroke()),b.restore())},clone:function(b,a){return this.constructor.fromObject?
this.constructor.fromObject(this.toObject(a),b):new f.Object(this.toObject(a))},cloneAsImage:function(a){var c=this.toDataURL();f.util.loadImage(c,function(c){a&&a(new f.Image(c))});return this},toDataURL:function(a){a||(a={});var c=f.util.createCanvasElement(),e=this.getBoundingRect();c.width=e.width;c.height=e.height;f.util.wrapElement(c,"div");e=new f.StaticCanvas(c);"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(e.backgroundColor="#fff");var d={active:this.get("active"),left:this.getLeft(),
top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new f.Point(c.width/2,c.height/2),"center","center");c=this.canvas;e.add(this);a=e.toDataURL(a);this.set(d).setCoords();this.canvas=c;e.dispose();return a},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,c){c||(c={});var e={colorStops:[]};e.type=c.type||(c.r1||c.r2?"radial":"linear");e.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};if(c.r1||c.r2)e.coords.r1=
c.r1,e.coords.r2=c.r2;c.gradientTransform&&(e.gradientTransform=c.gradientTransform);for(var d in c.colorStops){var h=new f.Color(c.colorStops[d]);e.colorStops.push({offset:d,color:h.toRgb(),opacity:h.getAlpha()})}return this.set(a,f.Gradient.forObject(this,e))},setPatternFill:function(a){return this.set("fill",new f.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new f.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var c=("center"!==this.originX||
"center"!==this.originY)&&this.centeredRotation;c&&this._setOriginToCenter();this.set("angle",a);c&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,c){c=c||this.canvas.getPointer(a);var e=new f.Point(c.x,c.y),d=this._getLeftTopCoords();this.angle&&
(e=f.util.rotatePoint(e,d,f.util.degreesToRadians(-this.angle)));return{x:e.x-d.x,y:e.y-d.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}}),f.util.createAccessors(f.Object),f.Object.prototype.rotate=f.Object.prototype.setAngle,h(f.Object.prototype,f.Observable),f.Object.NUM_FRACTION_DIGITS=2,f.Object.__uid=0)})("undefined"!==typeof exports?exports:this);
(function(){var h=fabric.util.degreesToRadians,f={left:-0.5,center:0,right:0.5},d={top:-0.5,center:0,bottom:0.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(c,a,e,b,g){var h=c.x,z=c.y;a=f[b]-f[a];e=d[g]-d[e];if(a||e)z=this._getTransformedDimensions(),h=c.x+a*z.x,z=c.y+e*z.y;return new fabric.Point(h,z)},translateToCenterPoint:function(c,a,e){a=this.translateToGivenOrigin(c,a,e,"center","center");return this.angle?fabric.util.rotatePoint(a,c,h(this.angle)):a},
translateToOriginPoint:function(c,a,e){a=this.translateToGivenOrigin(c,"center","center",a,e);return this.angle?fabric.util.rotatePoint(a,c,h(this.angle)):a},getCenterPoint:function(){var c=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(c,this.originX,this.originY)},getPointByOrigin:function(c,a){var e=this.getCenterPoint();return this.translateToOriginPoint(e,c,a)},toLocalPoint:function(c,a,e){var b=this.getCenterPoint();a=a&&e?this.translateToGivenOrigin(b,"center","center",
a,e):new fabric.Point(this.left,this.top);c=new fabric.Point(c.x,c.y);this.angle&&(c=fabric.util.rotatePoint(c,b,-h(this.angle)));return c.subtractEquals(a)},setPositionByOrigin:function(c,a,e){c=this.translateToCenterPoint(c,a,e);c=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",c.x);this.set("top",c.y)},adjustPosition:function(c){var a=h(this.angle),e=this.getWidth(),b=Math.cos(a)*e,a=Math.sin(a)*e;this.left+=b*(f[c]-f[this.originX]);this.top+=a*(f[c]-f[this.originX]);this.setCoords();
this.originX=c},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var c=this.getCenterPoint();this.originY=this.originX="center";this.left=c.x;this.top=c.y},_resetOrigin:function(){var c=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=c.x;this.top=c.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),
"left","top")}})})();
(function(){function h(c){return[new fabric.Point(c.tl.x,c.tl.y),new fabric.Point(c.tr.x,c.tr.y),new fabric.Point(c.br.x,c.br.y),new fabric.Point(c.bl.x,c.bl.y)]}var f=fabric.util.degreesToRadians,d=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(c,a){var e=h(this.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(e,c,a).status},intersectsWithObject:function(c){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(h(this.oCoords),
h(c.oCoords)).status},isContainedWithinObject:function(c){var a=c.getBoundingRect();c=new fabric.Point(a.left,a.top);a=new fabric.Point(a.left+a.width,a.top+a.height);return this.isContainedWithinRect(c,a)},isContainedWithinRect:function(c,a){var e=this.getBoundingRect();return e.left>=c.x&&e.left+e.width<=a.x&&e.top>=c.y&&e.top+e.height<=a.y},containsPoint:function(c){var a=this._getImageLines(this.oCoords);c=this._findCrossPoints(c,a);return 0!==c&&1===c%2},_getImageLines:function(c){return{topline:{o:c.tl,
d:c.tr},rightline:{o:c.tr,d:c.br},bottomline:{o:c.br,d:c.bl},leftline:{o:c.bl,d:c.tl}}},_findCrossPoints:function(c,a){var e,b,g,d=0,f;for(f in a)if(g=a[f],!(g.o.y<c.y&&g.d.y<c.y||g.o.y>=c.y&&g.d.y>=c.y)&&(g.o.x===g.d.x&&g.o.x>=c.x?e=g.o.x:(e=(g.d.y-g.o.y)/(g.d.x-g.o.x),b=c.y-0*c.x,g=g.o.y-e*g.o.x,e=-(b-g)/(0-e)),e>=c.x&&(d+=1),2===d))break;return d},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||
this.setCoords();return fabric.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(c){return Math.abs(c)<this.minScaleLimit?0>c?-this.minScaleLimit:this.minScaleLimit:c},scale:function(c){c=this._constrainScale(c);0>c&&(this.flipX=!this.flipX,this.flipY=!this.flipY,c*=-1);this.scaleY=this.scaleX=c;this.setCoords();
return this},scaleToWidth:function(c){var a=this.getBoundingRect().width/this.getWidth();return this.scale(c/this.width/a)},scaleToHeight:function(c){var a=this.getBoundingRect().height/this.getHeight();return this.scale(c/this.height/a)},setCoords:function(){var c=f(this.angle),a=this.getViewportTransform(),e=this._calculateCurrentDimensions(),b=e.x,g=e.y;0>b&&(b=Math.abs(b));var e=Math.sin(c),d=Math.cos(c),h=0<b?Math.atan(g/b):0,v=b/Math.cos(h)/2,u=Math.cos(h+c)*v,c=Math.sin(h+c)*v,h=fabric.util.transformPoint(this.getCenterPoint(),
a),a=new fabric.Point(h.x-u,h.y-c),b=new fabric.Point(a.x+b*d,a.y+b*e),g=new fabric.Point(a.x-g*e,a.y+g*d),u=new fabric.Point(h.x+u,h.y+c),c=new fabric.Point((a.x+g.x)/2,(a.y+g.y)/2),h=new fabric.Point((b.x+a.x)/2,(b.y+a.y)/2),v=new fabric.Point((u.x+b.x)/2,(u.y+b.y)/2),C=new fabric.Point((u.x+g.x)/2,(u.y+g.y)/2),e=new fabric.Point(h.x+e*this.rotatingPointOffset,h.y-d*this.rotatingPointOffset);this.oCoords={tl:a,tr:b,br:u,bl:g,ml:c,mt:h,mr:v,mb:C,mtr:e};this._setCornerCoords&&this._setCornerCoords();
return this},_calcRotateMatrix:function(){if(this.angle){var c=f(this.angle),a=Math.cos(c),c=Math.sin(c);return[a,c,-c,a,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var c=this.getCenterPoint(),c=[1,0,0,1,c.x,c.y],a=this._calcRotateMatrix(),e=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),b=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0],b=d(b,c),b=d(b,a);return b=d(b,e)},_calcDimensionsTransformMatrix:function(c,a,e){c=[1,0,Math.tan(f(c)),1];a=[1,Math.tan(f(a)),
0,1];e=d([this.scaleX*(e&&this.flipX?-1:1),0,0,this.scaleY*(e&&this.flipY?-1:1)],c,!0);return d(e,a,!0)}})})();
fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(h){this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,h):this.canvas.sendBackwards(this,h);return this},bringForward:function(h){this.group?
fabric.StaticCanvas.prototype.bringForward.call(this.group,this,h):this.canvas.bringForward(this,h);return this},moveTo:function(h){this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,h):this.canvas.moveTo(this,h);return this}});
fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var h=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",f=this.fillRule,d=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",c=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"none",e=this.strokeLineCap?this.strokeLineCap:"butt",b=this.strokeLineJoin?this.strokeLineJoin:"miter",g=this.strokeMiterLimit?this.strokeMiterLimit:
"4",q="undefined"!==typeof this.opacity?this.opacity:"1",z=this.visible?"":" visibility: hidden;",v=this.getSvgFilter();return["stroke: ",d,"; stroke-width: ",c,"; stroke-dasharray: ",a,"; stroke-linecap: ",e,"; stroke-linejoin: ",b,"; stroke-miterlimit: ",g,"; fill: ",h,"; fill-rule: ",f,"; opacity: ",q,";",v,z].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var h=
fabric.util.toFixed,f=this.getAngle(),d=this.getSkewX()%360,c=this.getSkewY()%360,a=this.getCenterPoint(),e=fabric.Object.NUM_FRACTION_DIGITS,a="path-group"===this.type?"":"translate("+h(a.x,e)+" "+h(a.y,e)+")",f=0!==f?" rotate("+h(f,e)+")":"",b=1===this.scaleX&&1===this.scaleY?"":" scale("+h(this.scaleX,e)+" "+h(this.scaleY,e)+")",d=0!==d?" skewX("+h(d,e)+")":"",h=0!==c?" skewY("+h(c,e)+")":"",c="path-group"===this.type?this.width:0,e="path-group"===this.type?this.height:0;return[a,f,b,this.flipX?
" matrix(-1 0 0 1 "+c+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+e+")":"",d,h].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var h=[];this.fill&&this.fill.toLive&&h.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&h.push(this.stroke.toSVG(this,!1));this.shadow&&h.push(this.shadow.toSVG(this));return h}});
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(h){return this.get(h)!==this.originalState[h]},this)},saveState:function(h){this.stateProperties.forEach(function(f){this.originalState[f]=this.get(f)},this);h&&h.stateProperties&&h.stateProperties.forEach(function(f){this.originalState[f]=this.get(f)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var h=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(f){if(!this.hasControls||!this.active)return!1;var d=f.x;f=f.y;var c;this.__corner=0;for(var a in this.oCoords)if(this.isControlVisible(a)&&("mtr"!==a||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==a&&"mr"!==a&&"mb"!==a&&"ml"!==a)&&(c=this._getImageLines(this.oCoords[a].corner),c=this._findCrossPoints({x:d,y:f},c),0!==c&&1===c%2))return this.__corner=
a;return!1},_setCornerCoords:function(){var f=this.oCoords,d=h(45-this.angle),c=0.707106*this.cornerSize,a=c*Math.cos(d),d=c*Math.sin(d),e,b;for(b in f)c=f[b].x,e=f[b].y,f[b].corner={tl:{x:c-d,y:e-a},tr:{x:c+a,y:e-d},bl:{x:c-a,y:e+d},br:{x:c+d,y:e+a}}},_getNonTransformedDimensions:function(){var f=this.strokeWidth,d=this.width,c=this.height,a=!0,e=!0;"line"===this.type&&"butt"===this.strokeLineCap&&(e=d,a=c);e&&(c+=0>c?-f:f);a&&(d+=0>d?-f:f);return{x:d,y:c}},_getTransformedDimensions:function(f,d){"undefined"===
typeof f&&(f=this.skewX);"undefined"===typeof d&&(d=this.skewY);for(var c=this._getNonTransformedDimensions(),a=c.x/2,c=c.y/2,a=[{x:-a,y:-c},{x:a,y:-c},{x:-a,y:c},{x:a,y:c}],e=this._calcDimensionsTransformMatrix(f,d,!1),c=0;c<a.length;c++)a[c]=fabric.util.transformPoint(a[c],e);a=fabric.util.makeBoundingBoxFromPoints(a);return{x:a.width,y:a.height}},_calculateCurrentDimensions:function(){var f=this.getViewportTransform(),d=this._getTransformedDimensions(),c=d.x,d=d.y,c=c+2*this.padding,d=d+2*this.padding;
return fabric.util.transformPoint(new fabric.Point(c,d),f,!0)},drawBorders:function(f){if(!this.hasBorders)return this;var d=this._calculateCurrentDimensions(),c=1/this.borderScaleFactor,a=d.x+c,d=d.y+c;f.save();f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;f.strokeStyle=this.borderColor;f.lineWidth=c;f.strokeRect(-a/2,-d/2,a,d);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(c=-d/2,f.beginPath(),f.moveTo(0,c),f.lineTo(0,c-this.rotatingPointOffset),
f.closePath(),f.stroke());f.restore();return this},drawBordersInGroup:function(f,d){if(!this.hasBorders)return this;var c=this._getNonTransformedDimensions(),a=fabric.util.customTransformMatrix(d.scaleX,d.scaleY,d.skewX),e=fabric.util.transformPoint(c,a),c=1/this.borderScaleFactor,a=e.x+c+2*this.padding,e=e.y+c+2*this.padding;f.save();f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;f.strokeStyle=this.borderColor;f.lineWidth=c;f.strokeRect(-a/2,-e/2,a,e);f.restore();return this},drawControls:function(f){if(!this.hasControls)return this;
var d=this._calculateCurrentDimensions(),c=d.x,d=d.y,a=this.cornerSize,e=-(c+a)/2,a=-(d+a)/2,b=this.transparentCorners?"strokeRect":"fillRect";f.save();f.lineWidth=1;f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;f.strokeStyle=f.fillStyle=this.cornerColor;this._drawControl("tl",f,b,e,a);this._drawControl("tr",f,b,e+c,a);this._drawControl("bl",f,b,e,a+d);this._drawControl("br",f,b,e+c,a+d);this.get("lockUniScaling")||(this._drawControl("mt",f,b,e+c/2,a),this._drawControl("mb",f,b,e+c/2,
a+d),this._drawControl("mr",f,b,e+c,a+d/2),this._drawControl("ml",f,b,e,a+d/2));this.hasRotatingPoint&&this._drawControl("mtr",f,b,e+c/2,a-this.rotatingPointOffset);f.restore();return this},_drawControl:function(f,d,c,a,e){this.isControlVisible(f)&&(f=this.cornerSize,"undefined"!==typeof G_vmlCanvasManager||this.transparentCorners||d.clearRect(a,e,f,f),d[c](a,e,f,f))},isControlVisible:function(f){return this._getControlsVisibility()[f]},setControlVisible:function(f,d){this._getControlsVisibility()[f]=
d;return this},setControlsVisibility:function(f){f||(f={});for(var d in f)this.setControlVisible(d,f[d]);return this},_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();
(function(h){function f(a,c){var e=a.origin,d=a.axis1,f=a.axis2,h=a.dimension,C=c.nearest,y=c.center,t=c.farthest;return function(){switch(this.get(e)){case C:return Math.min(this.get(d),this.get(f));case y:return Math.min(this.get(d),this.get(f))+0.5*this.get(h);case t:return Math.max(this.get(d),this.get(f))}}}var d=h.fabric||(h.fabric={}),c=d.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},e=d.StaticCanvas.supports("setLineDash");d.Line?d.warn("fabric.Line is already defined"):(d.Line=d.util.createClass(d.Object,
{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,c){c=c||{};a||(a=[0,0,0,0]);this.callSuper("initialize",c);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(c)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(b,c){this.callSuper("_set",b,c);"undefined"!==typeof a[b]&&
this._setWidthHeight();return this},_getLeftToOriginX:f({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:f({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,c){a.beginPath();if(c){var d=this.getCenterPoint();a.translate(d.x-this.strokeWidth/2,d.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&e)d=this.calcLinePoints(),a.moveTo(d.x1,
d.y1),a.lineTo(d.x2,d.y2);a.lineWidth=this.strokeWidth;d=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=d},_renderDashedStroke:function(a){var c=this.calcLinePoints();a.beginPath();d.util.drawDashedLine(a,c.x1,c.y1,c.x2,c.y2,this.strokeDashArray);a.closePath()},toObject:function(a){return c(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,c=this.y1<=this.y2?-1:1;return{x1:0.5*a*this.width,
x2:-0.5*a*this.width,y1:0.5*c*this.height,y2:-0.5*c*this.height}},toSVG:function(a){var c=this._createBaseSVGMarkup(),e={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&"path-group"===this.group.type||(e=this.calcLinePoints());c.push("<line ",'x1="',e.x1,'" y1="',e.y1,'" x2="',e.x2,'" y2="',e.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},complexity:function(){return 1}}),d.Line.fromObject=
function(a){return new d.Line([a.x1,a.y1,a.x2,a.y2],a)})})("undefined"!==typeof exports?exports:this);
(function(h){var f=h.fabric||(h.fabric={}),d=Math.PI,c=f.util.object.extend;f.Circle?f.warn("fabric.Circle is already defined."):(f.Circle=f.util.createClass(f.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*d,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,c){this.callSuper("_set",a,c);"radius"===a&&this.setRadius(c);return this},toObject:function(a){return c(this.callSuper("toObject",
a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var c=this._createBaseSVGMarkup(),b=0,g=0,f=(this.endAngle-this.startAngle)%(2*d);if(0===f)this.group&&"path-group"===this.group.type&&(b=this.left+this.radius,g=this.top+this.radius),c.push("<circle ",'cx="'+b+'" cy="'+g+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var b=Math.cos(this.startAngle)*this.radius,
g=Math.sin(this.startAngle)*this.radius,h=Math.cos(this.endAngle)*this.radius,v=Math.sin(this.endAngle)*this.radius;c.push('<path d="M '+b+" "+g," A "+this.radius+" "+this.radius," 0 ",+(f>d?1:0)+" 1"," "+h+" "+v,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return a?a(c.join("")):c.join("")},_render:function(a,c){a.beginPath();a.arc(c?this.left+this.radius:0,c?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);
this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;return this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),f.Circle.fromObject=function(a){return new f.Circle(a)})})("undefined"!==typeof exports?exports:this);
(function(h){var f=h.fabric||(h.fabric={});f.Triangle?f.warn("fabric.Triangle is already defined"):(f.Triangle=f.util.createClass(f.Object,{type:"triangle",initialize:function(d){d=d||{};this.callSuper("initialize",d);this.set("width",d.width||100).set("height",d.height||100)},_render:function(d){var c=this.width/2,a=this.height/2;d.beginPath();d.moveTo(-c,a);d.lineTo(0,-a);d.lineTo(c,a);d.closePath();this._renderFill(d);this._renderStroke(d)},_renderDashedStroke:function(d){var c=this.width/2,a=
this.height/2;d.beginPath();f.util.drawDashedLine(d,-c,a,0,-a,this.strokeDashArray);f.util.drawDashedLine(d,0,-a,c,a,this.strokeDashArray);f.util.drawDashedLine(d,c,a,-c,a,this.strokeDashArray);d.closePath()},toSVG:function(d){var c=this._createBaseSVGMarkup(),a=this.width/2,e=this.height/2,a=[-a+" "+e,"0 "+-e,a+" "+e].join();c.push("<polygon ",'points="',a,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return d?d(c.join("")):c.join("")},complexity:function(){return 1}}),
f.Triangle.fromObject=function(d){return new f.Triangle(d)})})("undefined"!==typeof exports?exports:this);
(function(h){var f=h.fabric||(h.fabric={}),d=2*Math.PI,c=f.util.object.extend;f.Ellipse?f.warn("fabric.Ellipse is already defined."):(f.Ellipse=f.util.createClass(f.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,c){this.callSuper("_set",a,c);switch(a){case "rx":this.rx=c;this.set("width",2*c);break;case "ry":this.ry=c,this.set("height",2*c)}return this},getRx:function(){return this.get("rx")*
this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return c(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var c=this._createBaseSVGMarkup(),b=0,g=0;this.group&&"path-group"===this.group.type&&(b=this.left+this.rx,g=this.top+this.ry);c.push("<ellipse ",'cx="',b,'" cy="',g,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');
return a?a(c.join("")):c.join("")},_render:function(a,c){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(c?this.left+this.rx:0,c?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,d,!1);a.restore();this._renderFill(a);this._renderStroke(a)},complexity:function(){return 1}}),f.Ellipse.fromObject=function(a){return new f.Ellipse(a)})})("undefined"!==typeof exports?exports:this);
(function(h){var f=h.fabric||(h.fabric={}),d=f.util.object.extend;f.Rect?f.warn("fabric.Rect is already defined"):(h=f.Object.prototype.stateProperties.concat(),h.push("rx","ry","x","y"),f.Rect=f.util.createClass(f.Object,{stateProperties:h,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(c){c=c||{};this.callSuper("initialize",c);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(c,a){if(1===this.width&&1===
this.height)c.fillRect(0,0,1,1);else{var e=this.rx?Math.min(this.rx,this.width/2):0,b=this.ry?Math.min(this.ry,this.height/2):0,g=this.width,d=this.height,f=a?this.left:-this.width/2,h=a?this.top:-this.height/2,u=0!==e||0!==b;c.beginPath();c.moveTo(f+e,h);c.lineTo(f+g-e,h);u&&c.bezierCurveTo(f+g-0.4477152502*e,h,f+g,h+0.4477152502*b,f+g,h+b);c.lineTo(f+g,h+d-b);u&&c.bezierCurveTo(f+g,h+d-0.4477152502*b,f+g-0.4477152502*e,h+d,f+g-e,h+d);c.lineTo(f+e,h+d);u&&c.bezierCurveTo(f+0.4477152502*e,h+d,f,h+
d-0.4477152502*b,f,h+d-b);c.lineTo(f,h+b);u&&c.bezierCurveTo(f,h+0.4477152502*b,f+0.4477152502*e,h,f+e,h);c.closePath();this._renderFill(c);this._renderStroke(c)}},_renderDashedStroke:function(c){var a=-this.width/2,e=-this.height/2,b=this.width,g=this.height;c.beginPath();f.util.drawDashedLine(c,a,e,a+b,e,this.strokeDashArray);f.util.drawDashedLine(c,a+b,e,a+b,e+g,this.strokeDashArray);f.util.drawDashedLine(c,a+b,e+g,a,e+g,this.strokeDashArray);f.util.drawDashedLine(c,a,e+g,a,e,this.strokeDashArray);
c.closePath()},toObject:function(c){c=d(this.callSuper("toObject",c),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||this._removeDefaultValues(c);return c},toSVG:function(c){var a=this._createBaseSVGMarkup(),e=this.left,b=this.top;this.group&&"path-group"===this.group.type||(e=-this.width/2,b=-this.height/2);a.push("<rect ",'x="',e,'" y="',b,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',
this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return c?c(a.join("")):a.join("")},complexity:function(){return 1}}),f.Rect.fromObject=function(c){return new f.Rect(c)})})("undefined"!==typeof exports?exports:this);
(function(h){var f=h.fabric||(h.fabric={});f.Polyline?f.warn("fabric.Polyline is already defined"):(f.Polyline=f.util.createClass(f.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(d,c){return f.Polygon.prototype.initialize.call(this,d,c)},_calcDimensions:function(){return f.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return f.Polygon.prototype._applyPointOffset.call(this)},toObject:function(d){return f.Polygon.prototype.toObject.call(this,d)},toSVG:function(d){return f.Polygon.prototype.toSVG.call(this,
d)},_render:function(d){f.Polygon.prototype.commonRender.call(this,d)&&(this._renderFill(d),this._renderStroke(d))},_renderDashedStroke:function(d){var c,a;d.beginPath();for(var e=0,b=this.points.length;e<b;e++)c=this.points[e],a=this.points[e+1]||c,f.util.drawDashedLine(d,c.x,c.y,a.x,a.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),f.Polyline.fromObject=function(d){return new f.Polyline(d.points,d,!0)})})("undefined"!==typeof exports?exports:this);
(function(h){var f=h.fabric||(h.fabric={}),d=f.util.object.extend,c=f.util.array.min,a=f.util.array.max,e=f.util.toFixed;f.Polygon?f.warn("fabric.Polygon is already defined"):(f.Polygon=f.util.createClass(f.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,c){c=c||{};this.points=a||[];this.callSuper("initialize",c);this._calcDimensions();"top"in c||(this.top=this.minY);"left"in c||(this.left=this.minX);this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var b=
this.points,g=c(b,"x"),e=c(b,"y"),d=a(b,"x"),b=a(b,"y");this.width=d-g||0;this.height=b-e||0;this.minX=g||0;this.minY=e||0},toObject:function(a){return d(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var c=[],d,f=this._createBaseSVGMarkup(),h=0,u=this.points.length;h<u;h++)c.push(e(this.points[h].x,2),",",e(this.points[h].y,2)," ");this.group&&"path-group"===this.group.type||(d=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");f.push("<",this.type,
" ",'points="',c.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),d," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(f.join("")):f.join("")},_render:function(a,c){this.commonRender(a,c)&&(this._renderFill(a),this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a))},commonRender:function(a,c){var e,d=this.points.length;if(!d||isNaN(this.points[d-1].y))return!1;c||a.translate(-this.pathOffset.x,-this.pathOffset.y);a.beginPath();a.moveTo(this.points[0].x,
this.points[0].y);for(var f=0;f<d;f++)e=this.points[f],a.lineTo(e.x,e.y);return!0},_renderDashedStroke:function(a){f.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}}),f.Polygon.fromObject=function(a){return new f.Polygon(a.points,a,!0)})})("undefined"!==typeof exports?exports:this);
(function(h){var f=h.fabric||(h.fabric={}),d=f.util.array.min,c=f.util.array.max,a=f.util.object.extend,e=Object.prototype.toString,b=f.util.drawArc,g={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},q={m:"l",M:"L"};f.Path?f.warn("fabric.Path is already defined"):(f.Path=f.util.createClass(f.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.setOptions(b);a||(a=[]);var c="[object Array]"===e.call(a);if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))c||(this.path=
this._parsePath()),this._setPositionDimensions(b),b.sourcePath&&this.setSourcePath(b.sourcePath)},_setPositionDimensions:function(a){var b=this._parseDimensions();this.minX=b.left;this.minY=b.top;this.width=b.width;this.height=b.height;"undefined"===typeof a.left&&(this.left=b.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0));"undefined"===typeof a.top&&(this.top=b.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0));this.pathOffset=this.pathOffset||
{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(a){var c,g=null,e=0,d=0,f=0,h=0,q=0,m=0,n,s,r=-this.pathOffset.x,p=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(p=r=0);a.beginPath();for(var w=0,B=this.path.length;w<B;++w){c=this.path[w];switch(c[0]){case "l":f+=c[1];h+=c[2];a.lineTo(f+r,h+p);break;case "L":f=c[1];h=c[2];a.lineTo(f+r,h+p);break;case "h":f+=c[1];a.lineTo(f+r,h+p);break;case "H":f=c[1];a.lineTo(f+r,h+p);break;case "v":h+=c[1];a.lineTo(f+r,h+p);
break;case "V":h=c[1];a.lineTo(f+r,h+p);break;case "m":f+=c[1];h+=c[2];e=f;d=h;a.moveTo(f+r,h+p);break;case "M":f=c[1];h=c[2];e=f;d=h;a.moveTo(f+r,h+p);break;case "c":n=f+c[5];s=h+c[6];q=f+c[3];m=h+c[4];a.bezierCurveTo(f+c[1]+r,h+c[2]+p,q+r,m+p,n+r,s+p);f=n;h=s;break;case "C":f=c[5];h=c[6];q=c[3];m=c[4];a.bezierCurveTo(c[1]+r,c[2]+p,q+r,m+p,f+r,h+p);break;case "s":n=f+c[3];s=h+c[4];null===g[0].match(/[CcSs]/)?(q=f,m=h):(q=2*f-q,m=2*h-m);a.bezierCurveTo(q+r,m+p,f+c[1]+r,h+c[2]+p,n+r,s+p);q=f+c[1];
m=h+c[2];f=n;h=s;break;case "S":n=c[3];s=c[4];null===g[0].match(/[CcSs]/)?(q=f,m=h):(q=2*f-q,m=2*h-m);a.bezierCurveTo(q+r,m+p,c[1]+r,c[2]+p,n+r,s+p);f=n;h=s;q=c[1];m=c[2];break;case "q":n=f+c[3];s=h+c[4];q=f+c[1];m=h+c[2];a.quadraticCurveTo(q+r,m+p,n+r,s+p);f=n;h=s;break;case "Q":n=c[3];s=c[4];a.quadraticCurveTo(c[1]+r,c[2]+p,n+r,s+p);f=n;h=s;q=c[1];m=c[2];break;case "t":n=f+c[1];s=h+c[2];null===g[0].match(/[QqTt]/)?(q=f,m=h):(q=2*f-q,m=2*h-m);a.quadraticCurveTo(q+r,m+p,n+r,s+p);f=n;h=s;break;case "T":n=
c[1];s=c[2];null===g[0].match(/[QqTt]/)?(q=f,m=h):(q=2*f-q,m=2*h-m);a.quadraticCurveTo(q+r,m+p,n+r,s+p);f=n;h=s;break;case "a":b(a,f+r,h+p,[c[1],c[2],c[3],c[4],c[5],c[6]+f+r,c[7]+h+p]);f+=c[6];h+=c[7];break;case "A":b(a,f+r,h+p,[c[1],c[2],c[3],c[4],c[5],c[6]+r,c[7]+p]);f=c[6];h=c[7];break;case "z":case "Z":f=e,h=d,a.closePath()}g=c}this._renderFill(a);this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(b){b=
a(this.callSuper("toObject",b),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(b.sourcePath=this.sourcePath);this.transformMatrix&&(b.transformMatrix=this.transformMatrix);return b},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),g="",e=0,d=this.path.length;e<d;e++)b.push(this.path[e].join(" "));b=b.join(" ");this.group&&
"path-group"===this.group.type||(g=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");c.push("<path ",'d="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),g,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,e,d=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,f,h=0,l=this.path.length;h<l;h++){c=this.path[h];f=c.slice(1).trim();
for(b.length=0;e=d.exec(f);)b.push(e[0]);c=[c.charAt(0)];f=0;for(var m=b.length;f<m;f++)e=parseFloat(b[f]),isNaN(e)||c.push(e);e=c[0];f=g[e.toLowerCase()];m=q[e]||e;if(c.length-1>f)for(var n=1,s=c.length;n<s;n+=f)a.push([e].concat(c.slice(n,n+f))),e=m;else a.push(c)}return a},_parseDimensions:function(){for(var a=[],b=[],g,e=null,h=0,q=0,k=0,l=0,m=0,n=0,s,r,p,w=0,B=this.path.length;w<B;++w){g=this.path[w];switch(g[0]){case "l":k+=g[1];l+=g[2];p=[];break;case "L":k=g[1];l=g[2];p=[];break;case "h":k+=
g[1];p=[];break;case "H":k=g[1];p=[];break;case "v":l+=g[1];p=[];break;case "V":l=g[1];p=[];break;case "m":k+=g[1];l+=g[2];h=k;q=l;p=[];break;case "M":k=g[1];l=g[2];h=k;q=l;p=[];break;case "c":s=k+g[5];r=l+g[6];m=k+g[3];n=l+g[4];p=f.util.getBoundsOfCurve(k,l,k+g[1],l+g[2],m,n,s,r);k=s;l=r;break;case "C":k=g[5];l=g[6];m=g[3];n=g[4];p=f.util.getBoundsOfCurve(k,l,g[1],g[2],m,n,k,l);break;case "s":s=k+g[3];r=l+g[4];null===e[0].match(/[CcSs]/)?(m=k,n=l):(m=2*k-m,n=2*l-n);p=f.util.getBoundsOfCurve(k,l,
m,n,k+g[1],l+g[2],s,r);m=k+g[1];n=l+g[2];k=s;l=r;break;case "S":s=g[3];r=g[4];null===e[0].match(/[CcSs]/)?(m=k,n=l):(m=2*k-m,n=2*l-n);p=f.util.getBoundsOfCurve(k,l,m,n,g[1],g[2],s,r);k=s;l=r;m=g[1];n=g[2];break;case "q":s=k+g[3];r=l+g[4];m=k+g[1];n=l+g[2];p=f.util.getBoundsOfCurve(k,l,m,n,m,n,s,r);k=s;l=r;break;case "Q":m=g[1];n=g[2];p=f.util.getBoundsOfCurve(k,l,m,n,m,n,g[3],g[4]);k=g[3];l=g[4];break;case "t":s=k+g[1];r=l+g[2];null===e[0].match(/[QqTt]/)?(m=k,n=l):(m=2*k-m,n=2*l-n);p=f.util.getBoundsOfCurve(k,
l,m,n,m,n,s,r);k=s;l=r;break;case "T":s=g[1];r=g[2];null===e[0].match(/[QqTt]/)?(m=k,n=l):(m=2*k-m,n=2*l-n);p=f.util.getBoundsOfCurve(k,l,m,n,m,n,s,r);k=s;l=r;break;case "a":p=f.util.getBoundsOfArc(k,l,g[1],g[2],g[3],g[4],g[5],g[6]+k,g[7]+l);k+=g[6];l+=g[7];break;case "A":p=f.util.getBoundsOfArc(k,l,g[1],g[2],g[3],g[4],g[5],g[6],g[7]);k=g[6];l=g[7];break;case "z":case "Z":k=h,l=q}e=g;p.forEach(function(c){a.push(c.x);b.push(c.y)});a.push(k);b.push(l)}g=d(a)||0;e=d(b)||0;h=c(a)||0;q=c(b)||0;return{left:g,
top:e,width:h-g,height:q-e}}}),f.Path.fromObject=function(a,b){"string"===typeof a.path?f.loadSVGFromURL(a.path,function(c){c=c[0];var g=a.path;delete a.path;f.util.object.extend(c,a);c.setSourcePath(g);b(c)}):b(new f.Path(a.path,a))},f.Path.async=!0)})("undefined"!==typeof exports?exports:this);
(function(h){var f=h.fabric||(h.fabric={}),d=f.util.object.extend,c=f.util.array.invoke,a=f.Object.prototype.toObject;f.PathGroup?f.warn("fabric.PathGroup is already defined"):(f.PathGroup=f.util.createClass(f.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;b.toBeParsed&&(this.parseDimensionsFromPaths(b),delete b.toBeParsed);this.setOptions(b);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},
parseDimensionsFromPaths:function(a){for(var b,c,d=[],h=[],v,u=this.paths.length;u--;){b=this.paths[u];c=b.height+b.strokeWidth;v=b.width+b.strokeWidth;b=[{x:b.left,y:b.top},{x:b.left+v,y:b.top},{x:b.left,y:b.top+c},{x:b.left+v,y:b.top+c}];v=this.paths[u].transformMatrix;for(var C=0;C<b.length;C++)c=b[C],v&&(c=f.util.transformPoint(c,v,!1)),d.push(c.x),h.push(c.y)}a.width=Math.max.apply(null,d);a.height=Math.max.apply(null,h)},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,
this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&f.util.clipContext(this,a);a.translate(-this.width/2,-this.height/2);for(var b=0,c=this.paths.length;b<c;++b)this.paths[b].render(a,!0);this.clipTo&&a.restore();a.restore()}},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(e){e=d(a.call(this,e),{paths:c(this.getObjects(),"toObject",e)});this.sourcePath&&(e.sourcePath=
this.sourcePath);return e},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){var b=this.getObjects(),c=this.getPointByOrigin("left","top"),d="translate("+c.x+" "+c.y+")",c=this._createBaseSVGMarkup();c.push("<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),d,this.getSvgTransform(),'" ',">\n");for(var d=0,f=b.length;d<f;d++)c.push("\t",b[d].toSVG(a));c.push("</g>\n");return a?a(c.join("")):c.join("")},
toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill")||"";if("string"!==typeof a)return!1;a=a.toLowerCase();return this.getObjects().every(function(b){b=b.get("fill")||"";return"string"===typeof b&&b.toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),f.PathGroup.fromObject=
function(a,b){"string"===typeof a.paths?f.loadSVGFromURL(a.paths,function(c){var d=a.paths;delete a.paths;c=f.util.groupSVGElements(c,a,d);b(c)}):f.util.enlivenObjects(a.paths,function(c){delete a.paths;b(new f.PathGroup(c,a))})},f.PathGroup.async=!0)})("undefined"!==typeof exports?exports:this);
(function(h){var f=h.fabric||(h.fabric={}),d=f.util.object.extend,c=f.util.array.min,a=f.util.array.max,e=f.util.array.invoke;if(!f.Group){var b={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};f.Group=f.util.createClass(f.Object,f.Collection,{type:"group",strokeWidth:0,initialize:function(a,b,c){b=b||{};this._objects=[];c&&this.callSuper("initialize",b);this._objects=a||[];for(a=this._objects.length;a--;)this._objects[a].group=this;this.originalState=
{};b.originX&&(this.originX=b.originX);b.originY&&(this.originY=b.originY);c?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",b));this.setCoords();this.saveCoords()},_updateObjectsCoords:function(a){for(var b=this._objects.length;b--;)this._updateObjectCoords(this._objects[b],a)},_updateObjectCoords:function(a,b){a.__origHasControls=a.hasControls;a.hasControls=!1;if(!b){var c=a.getLeft(),d=a.getTop(),e=this.getCenterPoint();a.set({originalLeft:c,
originalTop:d,left:c-e.x,top:d-e.y});a.setCoords()}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();f.util.resetObjectTransform(this);a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas));this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._restoreObjectsState();
f.util.resetObjectTransform(this);this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this;a._set("canvas",this.canvas)},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){var c=this._objects.length;
if(this.delegatedProperties[a]||"canvas"===a)for(;c--;)this._objects[c].set(a,b);else for(;c--;)this._objects[c].setOnGroup(a,b);this.callSuper("_set",a,b)},toObject:function(a){return d(this.callSuper("toObject",a),{objects:e(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&f.util.clipContext(this,a);for(var b=0,c=this._objects.length;b<c;b++)this._renderObject(this._objects[b],
a);this.clipTo&&a.restore();a.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,d=this._objects.length;c<d;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){if(a.visible){var c=a.hasRotatingPoint;a.hasRotatingPoint=!1;a.render(b);a.hasRotatingPoint=c}},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(a){var b=a.calcTransformMatrix(),b=f.util.qrDecompose(b),c=new f.Point(b.translateX,
b.translateY);a.scaleX=b.scaleX;a.scaleY=b.scaleY;a.skewX=b.skewX;a.skewY=b.skewY;a.angle=b.angle;a.flipX=!1;a.flipY=!1;a.setPositionByOrigin(c,"center","center");return a},_restoreObjectState:function(a){this.realizeTransform(a);a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);delete a.group;return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},
hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_calcBounds:function(a){for(var b=[],c=[],d,e,f=["tr","br","bl","tl"],h=0,t=this._objects.length,k,l=f.length;h<t;++h)for(d=this._objects[h],d.setCoords(),k=0;k<l;k++)e=f[k],b.push(d.oCoords[e].x),c.push(d.oCoords[e].y);this.set(this._getBounds(b,c,a))},_getBounds:function(b,d,e){var h=f.util.invertTransform(this.getViewportTransform()),
u=f.util.transformPoint(new f.Point(c(b),c(d)),h);b=f.util.transformPoint(new f.Point(a(b),a(d)),h);b={width:b.x-u.x||0,height:b.y-u.y||0};e||(b.left=u.x||0,b.top=u.y||0,"center"===this.originX&&(b.left+=b.width/2),"right"===this.originX&&(b.left+=b.width),"center"===this.originY&&(b.top+=b.height/2),"bottom"===this.originY&&(b.top+=b.height));return b},toSVG:function(a){var b=this._createBaseSVGMarkup();b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),
'">\n');for(var c=0,d=this._objects.length;c<d;c++)b.push("\t",this._objects[c].toSVG(a));b.push("</g>\n");return a?a(b.join("")):b.join("")},get:function(a){if(a in b){if(this[a])return this[a];for(var c=0,d=this._objects.length;c<d;c++)if(this._objects[c][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});f.Group.fromObject=function(a,b){f.util.enlivenObjects(a.objects,function(c){delete a.objects;b&&b(new f.Group(c,a,!0))})};f.Group.async=
!0}})("undefined"!==typeof exports?exports:this);
(function(h){var f=fabric.util.object.extend;h.fabric||(h.fabric={});h.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,initialize:function(d,c){c||(c={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",c);this._initElement(d,c)},getElement:function(){return this._element},setElement:function(d,c,a){this._originalElement=
this._element=d;this._initConfig(a);0!==this.filters.length?this.applyFilters(c):c&&c();return this},setCrossOrigin:function(d){this.crossOrigin=d;this._element.crossOrigin=d;return this},getOriginalSize:function(){var d=this.getElement();return{width:d.width,height:d.height}},_stroke:function(d){d.save();this._setStrokeStyles(d);d.beginPath();d.strokeRect(-this.width/2,-this.height/2,this.width,this.height);d.closePath();d.restore()},_renderDashedStroke:function(d){var c=-this.width/2,a=-this.height/
2,e=this.width,b=this.height;d.save();this._setStrokeStyles(d);d.beginPath();fabric.util.drawDashedLine(d,c,a,c+e,a,this.strokeDashArray);fabric.util.drawDashedLine(d,c+e,a,c+e,a+b,this.strokeDashArray);fabric.util.drawDashedLine(d,c+e,a+b,c,a+b,this.strokeDashArray);fabric.util.drawDashedLine(d,c,a+b,c,a,this.strokeDashArray);d.closePath();d.restore()},toObject:function(d){var c=[];this.filters.forEach(function(a){a&&c.push(a.toObject())});d=f(this.callSuper("toObject",d),{src:this._originalElement.src||
this._originalElement._src,filters:c,crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice});0<this.resizeFilters.length&&(d.resizeFilters=this.resizeFilters.map(function(a){return a&&a.toObject()}));this.includeDefaultValues||this._removeDefaultValues(d);return d},toSVG:function(d){var c=this._createBaseSVGMarkup(),a=-this.width/2,e=-this.height/2,b="none";this.group&&"path-group"===this.group.type&&(a=this.left,e=this.top);"none"!==this.alignX&&"none"!==
this.alignY&&(b="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);c.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',a,'" y="',e,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',b,'"',"></image>\n");if(this.stroke||this.strokeDashArray)b=this.fill,this.fill=null,c.push("<rect ",'x="',a,'" y="',e,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),
'"/>\n'),this.fill=b;c.push("</g>\n");return d?d(c.join("")):c.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(d,c,a){fabric.util.loadImage(d,function(d){return this.setElement(d,c,a)},this,a&&a.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(d,c){this.constructor.fromObject(this.toObject(c),d)},applyFilters:function(d,c,a,e){c=c||this.filters;if(a=a||this._originalElement){var b=
a,g=fabric.util.createCanvasElement(),f=fabric.util.createImage(),h=this;g.width=b.width;g.height=b.height;g.getContext("2d").drawImage(b,0,0,b.width,b.height);if(0===c.length)return this._element=a,d&&d(),g;c.forEach(function(a){a&&a.applyTo(g,a.scaleX||h.scaleX,a.scaleY||h.scaleY);!e&&a&&"Resize"===a.type&&(h.width*=a.scaleX,h.height*=a.scaleY)});f.width=g.width;f.height=g.height;fabric.isLikelyNode?(f.src=g.toBuffer(void 0,fabric.Image.pngCompression),h._element=f,!e&&(h._filteredEl=f),d&&d()):
(f.onload=function(){h._element=f;!e&&(h._filteredEl=f);d&&d();f.onload=g=b=null},f.src=g.toDataURL("image/png"));return g}},_render:function(d,c){var a,e,b=this._findMargins(),g;a=c?this.left:-this.width/2;e=c?this.top:-this.height/2;"slice"===this.meetOrSlice&&(d.beginPath(),d.rect(a,e,this.width,this.height),d.clip());!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,g=this.applyFilters(null,this.resizeFilters,this._filteredEl||
this._originalElement,!0)):g=this._element;g&&d.drawImage(g,a+b.marginX,e+b.marginY,b.width,b.height);this._renderStroke(d)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var d=this.width,c=this.height,a=0,e=0;if("none"!==this.alignX||"none"!==this.alignY)d=[this.width/this._element.width,this.height/this._element.height],c="meet"===this.meetOrSlice?Math.min.apply(null,d):Math.max.apply(null,d),d=this._element.width*c,c*=this._element.height,
"Mid"===this.alignX&&(a=(this.width-d)/2),"Max"===this.alignX&&(a=this.width-d),"Mid"===this.alignY&&(e=(this.height-c)/2),"Max"===this.alignY&&(e=this.height-c);return{width:d,height:c,marginX:a,marginY:e}},_resetWidthHeight:function(){var d=this.getElement();this.set("width",d.width);this.set("height",d.height)},_initElement:function(d,c){this.setElement(fabric.util.getById(d),null,c);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(d){d||(d={});this.setOptions(d);
this._setWidthHeight(d);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(d,c){d&&d.length?fabric.util.enlivenObjects(d,function(a){c&&c(a)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(d){this.width="width"in d?d.width:this.getElement()?this.getElement().width||0:0;this.height="height"in d?d.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=
fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(d,c){fabric.util.loadImage(d.src,function(a){fabric.Image.prototype._initFilters.call(d,d.filters,function(e){d.filters=e||[];fabric.Image.prototype._initFilters.call(d,d.resizeFilters,function(b){d.resizeFilters=b||[];b=new fabric.Image(a,d);c&&c(b)})})},null,d.crossOrigin)},fabric.Image.fromURL=function(d,c,a){fabric.util.loadImage(d,function(d){c&&c(new fabric.Image(d,a))},null,a&&a.crossOrigin)},fabric.Image.async=!0,fabric.Image.pngCompression=
1)})("undefined"!==typeof exports?exports:this);
(function(h){var f=h.fabric||(h.fabric={}),d=f.util.object.extend,c=f.util.object.clone,a=f.util.toFixed,e=f.StaticCanvas.supports("setLineDash"),b=f.Object.NUM_FRACTION_DIGITS;f.Text?f.warn("fabric.Text is already defined"):(h=f.Object.prototype.stateProperties.concat(),h.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),f.Text=f.util.createClass(f.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,
fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:h,stroke:null,shadow:null,_fontSizeFraction:0.25,_fontSizeMult:1.13,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},
_initDimensions:function(a){this.__skipDimension||(a||(a=f.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this._cacheLinesWidth="justify"!==this.textAlign,this.width=this._getTextWidth(a),this._cacheLinesWidth=!0,this.height=this._getTextHeight(a))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&f.util.clipContext(this,
a);this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextBackground(a);this._setStrokeStyles(a);this._setFillStyles(a);this._renderText(a);this._renderTextDecoration(a);this.clipTo&&a.restore()},_renderText:function(a){this._translateForTextAlign(a);this._renderTextFill(a);this._renderTextStroke(a);this._translateForTextAlign(a,!0)},_translateForTextAlign:function(a,b){if("left"!==this.textAlign&&"justify"!==this.textAlign){var c=b?-1:1;a.translate("center"===this.textAlign?
c*this.width/2:c*this.width,0)}},_setTextStyles:function(a){a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(a){for(var b=this._getLineWidth(a,0),c=1,d=this._textLines.length;c<d;c++){var e=this._getLineWidth(a,c);e>b&&(b=e)}return b},_renderChars:function(a,b,c,d,e){var f=a.slice(0,-4);if(this[f].toLive){var h=-this.width/2+this[f].offsetX||
0,t=-this.height/2+this[f].offsetY||0;b.save();b.translate(h,t);d-=h;e-=t}b[a](c,d,e);this[f].toLive&&b.restore()},_renderTextLine:function(a,b,c,d,e,f){e-=this.fontSize*this._fontSizeFraction;var h=this._getLineWidth(b,f);if("justify"!==this.textAlign||this.width<h)this._renderChars(a,b,c,d,e,f);else for(var h=c.split(/\s+/),t=0,k=this._getWidthOfWords(b,c,f,0),k=this.width-k,l=h.length-1,k=0<l?k/l:0,l=0,m,n=0,s=h.length;n<s;n++){for(;" "===c[t]&&t<c.length;)t++;m=h[n];this._renderChars(a,b,m,d+
l,e,f,t);l+=this._getWidthOfWords(b,m,f,t)+k;t+=m.length}},_getWidthOfWords:function(a,b){return a.measureText(b.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a){if(this.fill||this._skipFillStrokeCheck)for(var b=0,c=0,d=this._textLines.length;c<d;c++){var e=this._getHeightOfLine(a,c),f=e/this.lineHeight;this._renderTextLine("fillText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+
b+f,c);b+=e}},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var b=0;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a);a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e&&a.setLineDash(this.strokeDashArray));a.beginPath();for(var c=0,d=this._textLines.length;c<d;c++){var f=this._getHeightOfLine(a,c),h=f/this.lineHeight;this._renderTextLine("strokeText",
a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+h,c);b+=f}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height))},_renderTextLinesBackground:function(a){if(this.textBackgroundColor){var b=
0,c=this._getHeightOfLine(),d,e;a.fillStyle=this.textBackgroundColor;for(var f=0,h=this._textLines.length;f<h;f++)""!==this._textLines[f]&&(d="justify"===this.textAlign?this.width:this._getLineWidth(a,f),e=this._getLineLeftOffset(d),a.fillRect(this._getLeftOffset()+e,this._getTopOffset()+b,d,this.fontSize*this._fontSizeMult)),b+=c}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=
[]},_shouldClearCache:function(){var a=!1;if(this._forceClearCache)return this._forceClearCache=!1,!0;for(var b in this._dimensionAffectingProps)this["__"+b]!==this[b]&&(this["__"+b]=this[b],a=!0);return a},_getLineWidth:function(a,b){if(this.__lineWidths[b])return this.__lineWidths[b];var c,d=this._textLines[b];""===d?c=0:"justify"===this.textAlign&&this._cacheLinesWidth?(c=d.split(/\s+/),c=1<c.length?this.width:a.measureText(d).width):c=a.measureText(d).width;this._cacheLinesWidth&&(this.__lineWidths[b]=
c);return c},_renderTextDecoration:function(a){if(this.textDecoration){var b=this.height/2,c=[];-1<this.textDecoration.indexOf("underline")&&c.push(0.85);-1<this.textDecoration.indexOf("line-through")&&c.push(0.43);-1<this.textDecoration.indexOf("overline")&&c.push(-0.12);if(0<c.length){var d,e=0,f,h,t,k,l,m;d=0;for(f=this._textLines.length;d<f;d++){k=this._getLineWidth(a,d);l=this._getLineLeftOffset(k);m=this._getHeightOfLine(a,d);h=0;for(t=c.length;h<t;h++)a.fillRect(this._getLeftOffset()+l,e+(this._fontSizeMult-
1+c[h])*this.fontSize-b,k,this.fontSize/15);e+=m}}}},_getFontDeclaration:function(){return[f.isLikelyNode?this.fontWeight:this.fontStyle,f.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",f.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(a.save(),this._setTextStyles(a),this._shouldClearCache()&&this._initDimensions(a),b||this.transform(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.group&&"path-group"===this.group.type&&
a.translate(this.left,this.top),this._render(a),a.restore())},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(a){a=d(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});this.includeDefaultValues||this._removeDefaultValues(a);return a},
toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this._getSVGLeftTopOffsets(this.ctx),c=this._getSVGTextAndBg(c.textTop,c.textLeft);this._wrapSVGTextAndBg(b,c);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){a=this._getHeightOfLine(a,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:a}},_wrapSVGTextAndBg:function(a,b){a.push('\t<g transform="',this.getSvgTransform(),
this.getSvgTransformMatrix(),'">\n',b.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >\n',b.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(a,b){var c=[],
d=[],e=0;this._setSVGBg(d);for(var f=0,h=this._textLines.length;f<h;f++)this.textBackgroundColor&&this._setSVGTextLineBg(d,f,b,a,e),this._setSVGTextLineText(f,c,e,b,a,d),e+=this._getHeightOfLine(this.ctx,f);return{textSpans:c,textBgRects:d}},_setSVGTextLineText:function(c,d,e,h,u){e=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-u+e-this.height/2;"justify"===this.textAlign?this._setSVGTextLineJustifed(c,d,e,h):d.push('\t\t\t<tspan x="',a(h+this._getLineLeftOffset(this._getLineWidth(this.ctx,
c)),b),'" ','y="',a(e,b),'" ',this._getFillAttributes(this.fill),">",f.util.string.escapeXml(this._textLines[c]),"</tspan>\n")},_setSVGTextLineJustifed:function(c,d,e,h){var u=f.util.createCanvasElement().getContext("2d");this._setTextStyles(u);var C=this._textLines[c],y=C.split(/\s+/),C=this._getWidthOfWords(u,C),C=this.width-C,t=y.length-1,C=0<t?C/t:0,k=this._getFillAttributes(this.fill),l;h+=this._getLineLeftOffset(this._getLineWidth(u,c));c=0;for(l=y.length;c<l;c++)t=y[c],d.push('\t\t\t<tspan x="',
a(h,b),'" ','y="',a(e,b),'" ',k,">",f.util.string.escapeXml(t),"</tspan>\n"),h+=this._getWidthOfWords(u,t)+C},_setSVGTextLineBg:function(c,d,e,f,h){c.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(e+this._getLineLeftOffset(this._getLineWidth(this.ctx,d)),b),'" y="',a(h-this.height/2,b),'" width="',a(this._getLineWidth(this.ctx,d),b),'" height="',a(this._getHeightOfLine(this.ctx,d)/this.lineHeight,b),'"></rect>\n')},_setSVGBg:function(c){this.backgroundColor&&c.push("\t\t<rect ",
this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,b),'" y="',a(-this.height/2,b),'" width="',a(this.width,b),'" height="',a(this.height,b),'"></rect>\n')},_getFillAttributes:function(a){var b=a&&"string"===typeof a?new f.Color(a):"";return b&&b.getSource()&&1!==b.getAlpha()?'opacity="'+b.getAlpha()+'" fill="'+b.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),
f.Text.fromObject=function(a){return new f.Text(a.text,c(a))},f.util.createAccessors(f.Text))})("undefined"!==typeof exports?exports:this);
